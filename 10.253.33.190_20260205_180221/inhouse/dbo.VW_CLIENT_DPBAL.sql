-- Object: VIEW dbo.VW_CLIENT_DPBAL
-- Server: 10.253.33.190 | DB: inhouse
--------------------------------------------------

CREATE VIEW [dbo].[VW_CLIENT_DPBAL]      
AS      
--SELECT PARTY_CODE = ISNULL(C.NISE_PARTY_CODE, ''), C.CLIENT_CODE,      
--ACTUAL_AMOUNT = ISNULL(V.CURR_BAL, 0), ACCRUAL_BAL = ISNULL(T.AMOUNT, 0), BRANCH_CODE = ISNULL(C.BRANCH_CODE, '')      
--FROM TBL_CLIENT_MASTER C WITH (NOLOCK)      
--LEFT OUTER JOIN       
--(SELECT CLIENT_CODE, AMOUNT = SUM(AMOUNT+SERV_TAX) FROM VW_BILL_TRANSACTION WITH (NOLOCK)       
--WHERE BILL_DATE IS NULL GROUP BY CLIENT_CODE) T       
--ON (T.CLIENT_CODE = C.CLIENT_CODE)      
--LEFT OUTER JOIN VW_ACC_CURR_BAL V WITH (NOLOCK) ON ('C' + CONVERT(VARCHAR, C.BENEF_ACCNO) = V.ACC_CODE)      
--WHERE C.CLIENT_CODE LIKE '12033200%' 

SELECT PARTY_CODE = ISNULL(DPAM_BBO_CODE, ''), DPAM_SBA_NO CLIENT_CODE,      
ACTUAL_AMOUNT = ISNULL(V.CURR_BAL, 0), 
ACCRUAL_BAL = ISNULL(T.AMOUNT, 0), BRANCH_CODE = 'HO'      
FROM DMAT.citrus_usr.DP_ACCT_MSTR C WITH (NOLOCK)      
LEFT OUTER JOIN       
(SELECT CLIENT_CODE, AMOUNT = SUM(AMOUNT+SERV_TAX) FROM VW_BILL_TRANSACTION WITH (NOLOCK)       
WHERE BILL_DATE IS NULL GROUP BY CLIENT_CODE) T       
ON (T.CLIENT_CODE = DPAM_SBA_NO)      
LEFT OUTER JOIN VW_ACC_CURR_BAL V WITH (NOLOCK) ON ('C' + CONVERT(VARCHAR, DPAM_SBA_NO) = V.ACC_CODE)      
WHERE DPAM_SBA_NO LIKE '12033200%'  AND DPAM_ACCT_NO<>DPAM_SBA_NO

GO
