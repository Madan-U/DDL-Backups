-- Object: PROCEDURE citrus_usr.PR_POASIG_IMPUPD_bak_07082019
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------



create  PROCEDURE [citrus_usr].[PR_POASIG_IMPUPD_bak_07082019]
(
@PA_ACTION VARCHAR(10)
)
AS
BEGIN

IF NOT EXISTS (SELECT TMPSIGN_SBA_NO FROM MOSL_BULK_BINARY_POA,TMP_POASIGN_NSDL WHERE IMAGEPATH=TMPSIGN_SBA_NO) 
BEGIN
UPDATE M SET IMAGEPATHBINARY=CLI_IMAGE FROM MOSL_BULK_BINARY_POA M ,TMP_POASIGN_NSDL WHERE IMAGEPATH=TMPSIGN_SBA_NO
--SELECT IDENTITY(NUMERIC,1,1) ID, TMPSIGN_SBA_NO,CLI_IMAGE INTO #TMP FROM TMP_POASIGN_NSDL WHERE TMPSIGN_SBA_NO NOT IN (SELECT IMAGEPATH FROM MOSL_BULK_BINARY_POA)

--INSERT INTO MOSL_BULK_BINARY_POA
--SELECT ID,TMPSIGN_SBA_NO,CLI_IMAGE FROM #TMP WHERE TMPSIGN_SBA_NO NOT IN (SELECT IMAGEPATH FROM MOSL_BULK_BINARY_POA)
END
ELSE
BEGIN

SELECT IDENTITY(NUMERIC,1,1) ID, TMPSIGN_SBA_NO,CLI_IMAGE INTO #TMP FROM TMP_POASIGN_NSDL WHERE TMPSIGN_SBA_NO NOT IN (SELECT IMAGEPATH FROM MOSL_BULK_BINARY_POA)

INSERT INTO MOSL_BULK_BINARY_POA
SELECT ID,TMPSIGN_SBA_NO,CLI_IMAGE FROM #TMP WHERE TMPSIGN_SBA_NO NOT IN (SELECT IMAGEPATH FROM MOSL_BULK_BINARY_POA)
--UPDATE M SET IMAGEPATHBINARY=CLI_IMAGE FROM MOSL_BULK_BINARY_POA M ,TMP_POASIGN_NSDL WHERE IMAGEPATH=TMPSIGN_SBA_NO
END

END

GO
