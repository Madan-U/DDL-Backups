-- Object: PROCEDURE citrus_usr.ISIN_FREE_DATA
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------

CREATE PROCEDURE ISIN_FREE_DATA
(
@ISIN VARCHAR(20),
@DATE VARCHAR(20)
)
AS BEGIN 

 SELECT * INTO #HOLD2 FROM  SYNERGY_HOLDING WITH(NOLOCK) WHERE HLD_HOLD_DATE =@DATE AND HLD_ISIN_CODE=@ISIN AND HLD_AC_TYPE='14'
  
  SELECT * INTO #CLOSIN1 FROM  VW_ISIN_RATE_MASTER A WITH(NOLOCK),
  (SELECT ISIN AS ISIN_NO,MAX(RATE_DATE) RATE  FROM  VW_ISIN_RATE_MASTER WITH(NOLOCK) WHERE  RATE_DATE <=@DATE GROUP BY ISIN )B
  WHERE A.ISIN=B.ISIN_NO  AND A.RATE_DATE =B.RATE 


select HLD_HOLD_DATE,HLD_AC_CODE,HLD_AC_TYPE,HLD_AC_POS,HLD_ISIN_CODE,STATUS,ACTIVE_DATE,NISE_PARTY_CODE
 from #HOLD2 A,TBL_CLIENT_MASTER B WITH(NOLOCK)
  where  HLD_AC_CODE=B.CLIENT_cODE
  
  END

GO
