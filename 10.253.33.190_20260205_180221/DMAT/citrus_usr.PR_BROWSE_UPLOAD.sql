-- Object: PROCEDURE citrus_usr.PR_BROWSE_UPLOAD
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------


CREATE PROCEDURE PR_BROWSE_UPLOAD
(
@PA_LOGIN_NAME VARCHAR(50)
,@PA_PROCESS VARCHAR(50)
)
AS
BEGIN 
DECLARE @SEPERATOR CHAR(1),
@CMIND_DPID VARCHAR(8)
,@CMIND_MASTERPOAID VARCHAR(20)
,@CMIND_NAME VARCHAR(200)
,@CMIND_ID VARCHAR(10)
,@CMIND_DESC VARCHAR(20)
,@CMIND_IND CHAR(1)

SELECT @SEPERATOR=SEPERATOR FROM BROWSE_MASTER WHERE VALUE=@PA_PROCESS
IF @PA_PROCESS='CMIND POA MASTER FILE'
BEGIN

INSERT INTO CM_IND_POA_MASTER
SELECT CITRUS_USR.FN_SPLITVAL_BY(MSTR_VALUE,1,'~')
,CITRUS_USR.FN_SPLITVAL_BY(MSTR_VALUE,2,'~')
,CITRUS_USR.FN_SPLITVAL_BY(MSTR_VALUE,3,'~')
,CITRUS_USR.FN_SPLITVAL_BY(MSTR_VALUE,4,'~')
,CITRUS_USR.FN_SPLITVAL_BY(MSTR_VALUE,5,'~')
, CASE WHEN CITRUS_USR.FN_SPLITVAL_BY(MSTR_VALUE,5,'~')='CORPORATE POA' THEN 'C' ELSE 'R' END
FROM TBL_BROWSE_MASTER 
WHERE NOT EXISTS (SELECT CMIND_MASTERPOAID FROM CM_IND_POA_MASTER WHERE CMIND_MASTERPOAID=CITRUS_USR.FN_SPLITVAL_BY(MSTR_VALUE,2,'~')
AND CMIND_DESC=CITRUS_USR.FN_SPLITVAL_BY(MSTR_VALUE,5,'~'))

EXEC PR_POAIND_UPDATE
		
END
END

GO
