-- Object: PROCEDURE citrus_usr.PR_INS_UPD_COMMISSION_DTLS
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------

CREATE PROCEDURE [citrus_usr].[PR_INS_UPD_COMMISSION_DTLS]
(
	@PA_COMMIS_ID INT,
	@PA_COMMIS_DPM_ID INT,
	@PA_COMMIS_TYPE CHAR(1),
	@PA_COMMIS_BR_ID VARCHAR(8000),
	@PA_COMMIS_AMT_TYP CHAR(1),
	@PA_COMMIS_AMT NUMERIC(18,2), 
	@PA_COMMIS_FRM_DT VARCHAR(20),
	@PA_COMMIS_TO_DT VARCHAR(20),
	@PA_COMMIS_CREATED_BY VARCHAR(25),
	@PA_COMMIS_ACTION VARCHAR(10),
	@PA_COMMIS_MIN_AMT NUMERIC(18,0),
	@PA_COMMIS_CR_DR CHAR(2), 
	@PA_COMMIS_DMT_EX CHAR(1),
	@PA_COMMIS_RMT_EX CHAR(1),
	@PA_REF_CUR VARCHAR(20) OUTPUT   
)
AS
BEGIN
	IF @PA_COMMIS_ACTION = 'INS'
	BEGIN
        IF NOT EXISTS(SELECT COMMIS_ID FROM COMMISSION_DTLS WHERE COMMIS_ID = @PA_COMMIS_ID)
        BEGIN   
			INSERT INTO COMMISSION_DTLS
			(
				COMMIS_DPM_ID,
				COMMIS_TYPE,
				COMMIS_BR_ID,
				COMMIS_AMT_TYP,
				COMMIS_AMT,
				COMMIS_FRM_DT,
				COMMIS_TO_DT,
				COMMIS_CREATED_BY,
				COMMIS_CREATED_DT,
				COMMIS_LST_UPD_BY,
				COMMIS_LST_UPD_DT,
				COMMIS_DELETED_IND,
				COMMIS_MIN_AMT,
				COMMIS_CR_DR,
				COMMIS_DMT_EX,
				COMMIS_RMT_EX
			)
			VALUES
			(
				@PA_COMMIS_DPM_ID,
				@PA_COMMIS_TYPE,
				@PA_COMMIS_BR_ID,
				@PA_COMMIS_AMT_TYP,
				@PA_COMMIS_AMT,
				@PA_COMMIS_FRM_DT,
				@PA_COMMIS_TO_DT,
				@PA_COMMIS_CREATED_BY,
				GETDATE(),
				@PA_COMMIS_CREATED_BY,
				GETDATE(),
				1,
				@PA_COMMIS_MIN_AMT,
				@PA_COMMIS_CR_DR,
				@PA_COMMIS_DMT_EX,
				@PA_COMMIS_RMT_EX
			)
        END
        ELSE
        BEGIN
			SET @PA_REF_CUR = 'DATA AVAILABLE IN SYSTEM'
        END
	END
	IF @PA_COMMIS_ACTION = 'EDT'
    BEGIN
	print '1'
		UPDATE COMMISSION_DTLS
		SET COMMIS_DPM_ID = @PA_COMMIS_DPM_ID,
			COMMIS_TYPE = @PA_COMMIS_TYPE,
			COMMIS_BR_ID = @PA_COMMIS_BR_ID,
			COMMIS_AMT_TYP = @PA_COMMIS_AMT_TYP,
			COMMIS_AMT = @PA_COMMIS_AMT,
			COMMIS_FRM_DT = @PA_COMMIS_FRM_DT,
			COMMIS_TO_DT = @PA_COMMIS_TO_DT,
			COMMIS_LST_UPD_BY = @PA_COMMIS_CREATED_BY,
			COMMIS_LST_UPD_DT = GETDATE(),
			COMMIS_MIN_AMT = @PA_COMMIS_MIN_AMT,
			COMMIS_CR_DR = @PA_COMMIS_CR_DR, 
			COMMIS_DMT_EX = @PA_COMMIS_DMT_EX,
			COMMIS_RMT_EX = @PA_COMMIS_RMT_EX
		WHERE COMMIS_ID = @PA_COMMIS_ID
    END
    IF @PA_COMMIS_ACTION = 'DEL'
    BEGIN
		DELETE FROM COMMISSION_DTLS WHERE COMMIS_ID = @PA_COMMIS_ID 
    END
	IF @PA_COMMIS_ACTION = 'SELALL'
    BEGIN
		print '1'
		

		SELECT  commis_id,				
				commis_type,
				commis_br_id,
				commis_amt_typ,
				commis_amt,
				convert(varchar(11),commis_frm_dt,103) frmdt,
				convert(varchar(11),commis_to_dt,103) todt,
				commis_min_amt,
				COMMIS_CR_DR,
				COMMIS_DMT_EX,
				COMMIS_RMT_EX
		FROM COMMISSION_DTLS WHERE COMMIS_TYPE = @PA_COMMIS_TYPE 
		AND ( commis_frm_dt BETWEEN @PA_COMMIS_FRM_DT AND @PA_COMMIS_TO_DT
		or commis_to_dt   BETWEEN @PA_COMMIS_FRM_DT AND @PA_COMMIS_TO_DT)
    END 
    IF @PA_COMMIS_ACTION = 'SEL'
    BEGIN
		SELECT * FROM COMMISSION_DTLS WHERE COMMIS_ID = @PA_COMMIS_ID 
    END 
END

GO
