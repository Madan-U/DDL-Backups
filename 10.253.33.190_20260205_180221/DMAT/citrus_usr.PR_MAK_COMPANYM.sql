-- Object: PROCEDURE citrus_usr.PR_MAK_COMPANYM
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------

--PR_MAK_COMPANYM '30','APP','SS','',0,'*|~*','|*~|',''
CREATE PROCEDURE [citrus_usr].[PR_MAK_COMPANYM](@PA_ID              VARCHAR(8000)
                               ,@PA_ACTION          VARCHAR(20)
                               ,@PA_LOGIN_NAME      VARCHAR(20)
                               ,@PA_VALUES          VARCHAR(8000) = ''
                               ,@PA_CHK_YN          INT
                               ,@ROWDELIMITER       CHAR(4)       = '*|~*'
                               ,@COLDELIMITER       CHAR(4)       = '|*~|'
                               ,@PA_ERRMSG          VARCHAR(8000) OUTPUT
                               )
AS
/*
*********************************************************************************
 SYSTEM         : CLASS
 MODULE NAME    : PR_MAK_COMPANYM
 DESCRIPTION    : THIS PROCEDURE WILL CONTAIN THE MAKER CHECKER FACILITY FOR COMPANY MASTER
 COPYRIGHT(C)   : ENC SOFTWARE SOLUTIONS PVT. LTD.
 VERSION HISTORY: 1.0
 VERS.  AUTHOR            DATE          REASON
 -----  -------------     ------------  --------------------------------------------------
 1.0    SUKHVINDER/TUSHAR 10-FEB-2007    VERSION.
 2.0    SUKHVINDER/TUSHAR 27-FEB-2007    ADDITION OF FIELD 'COMPM_RMKS'
-----------------------------------------------------------------------------------*/
BEGIN --#0
--
  SET NOCOUNT ON
  --
  DECLARE @@L_ERRORSTR              VARCHAR(8000)
        , @@DELIMETER               VARCHAR(10)
        , @@REMAININGSTRING_ID      VARCHAR(8000)
        , @@CURRSTRING_ID           VARCHAR(8000)
        , @@REMAININGSTRING_VAL     VARCHAR(8000)
        , @@CURRSTRING_VAL          VARCHAR(8000)
        , @@FOUNDAT                 INTEGER
        , @@DELIMETERLENGTH         INT
        , @@L_COMPM_ID              NUMERIC
        , @@L_COMPMM_ID             NUMERIC
        , @@L_COMPM_NAME1           VARCHAR(50)
        , @@L_COMPM_SHORT_NAME      VARCHAR(50)
        , @@L_COMPM_SEBI_REG_NO     VARCHAR(20)
        , @@L_COMPM_SERTAX_REGNO    VARCHAR(20)
        , @@L_COMPM_PAN_NO          VARCHAR(20)
        , @@L_COMPM_TYPE            VARCHAR(50)
        , @@L_COMPM_RMKS            VARCHAR(250)
        , @@L_ERROR                 VARCHAR(8000)
        
        ,@@L_COMPM_NSECM_MEM_CD     VARCHAR(25)
        ,@@L_COMPM_NSEFO_MEM_CD     VARCHAR(25)
        ,@@L_COMPM_BSECM_MEM_CD     VARCHAR(25)
        ,@@L_COMPM_BSEFO_MEM_CD     VARCHAR(25)
        ,@@L_COMPM_Ncdex_MEM_CD     VARCHAR(25)
        ,@@L_COMPM_mcx_MEM_CD       VARCHAR(25)
        ,@@L_COMPM_dgcx_MEM_CD      VARCHAR(25) 
        ,@@L_COMPM_nmc_MEM_CD       VARCHAR(25)
        ,@@L_COMPM_nsdl_dpid        VARCHAR(25)
        ,@@L_COMPM_cdsl_dpid        VARCHAR(25)
        
        
        
        
        
        
        
        
        
        
        
  --
  SET @@L_ERRORSTR          = ''
  SET @@DELIMETER           = '%'+ @ROWDELIMITER + '%'
  SET @@DELIMETERLENGTH     = LEN(@ROWDELIMITER)
  SET @@REMAININGSTRING_ID  = @PA_ID
  SET @@REMAININGSTRING_VAL = @PA_VALUES
  SET @@CURRSTRING_ID       = ''
  SET @@CURRSTRING_VAL      = ''
  --
  WHILE @@REMAININGSTRING_ID <> ''
  BEGIN --#1
  --
    SET @@FOUNDAT = 0
    SET @@FOUNDAT =  PATINDEX('%'+@@DELIMETER+'%',@@REMAININGSTRING_ID)
    --
    IF @@FOUNDAT > 0
    BEGIN
    --
      SET @@CURRSTRING_ID      = SUBSTRING(@@REMAININGSTRING_ID, 0, @@FOUNDAT)
      SET @@REMAININGSTRING_ID = SUBSTRING(@@REMAININGSTRING_ID, @@FOUNDAT+@@DELIMETERLENGTH, LEN(@@REMAININGSTRING_ID)-@@FOUNDAT+@@DELIMETERLENGTH)
    --
    END
    ELSE
    BEGIN
    --
      SET @@CURRSTRING_ID      = @@REMAININGSTRING_ID
      SET @@REMAININGSTRING_ID = ''
    --
    END
    --
    IF @@CURRSTRING_ID <> ''
    BEGIN --#2
    --
      WHILE @@REMAININGSTRING_VAL <> ''
      BEGIN --#3
      --
        SET @@FOUNDAT = 0
        SET @@FOUNDAT =  PATINDEX('%'+@@DELIMETER+'%',@@REMAININGSTRING_VAL)
        --
        IF @@FOUNDAT > 0
        BEGIN
        --
          SET @@CURRSTRING_VAL      = SUBSTRING(@@REMAININGSTRING_VAL, 0, @@FOUNDAT)
          SET @@REMAININGSTRING_VAL = SUBSTRING(@@REMAININGSTRING_VAL, @@FOUNDAT+@@DELIMETERLENGTH, LEN(@@REMAININGSTRING_VAL)-@@FOUNDAT+@@DELIMETERLENGTH)
        --
        END
        ELSE
        BEGIN
        --
          SET @@CURRSTRING_VAL      = @@REMAININGSTRING_VAL
          SET @@REMAININGSTRING_VAL = ''
        --
        END
        --
        IF @@CURRSTRING_VAL <> ''
        BEGIN --#4
        --
          SET @@L_COMPM_NAME1           = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 1),'')
          SET @@L_COMPM_SHORT_NAME      = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 2),'')
          SET @@L_COMPM_TYPE            = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 3),'')
          SET @@L_COMPM_NSECM_MEM_CD    = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 4),'')
          SET @@L_COMPM_NSEFO_MEM_CD    = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 5),'')
          SET @@L_COMPM_BSECM_MEM_CD    = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 6),'')
          SET @@L_COMPM_BSEFO_MEM_CD    = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 7),'')
          SET @@L_COMPM_Ncdex_MEM_CD    = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 8),'')
          SET @@L_COMPM_mcx_MEM_CD      = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 9),'')
          SET @@L_COMPM_dgcx_MEM_CD     = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 10),'')
          SET @@L_COMPM_nmc_MEM_CD      = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 11),'')
          SET @@L_COMPM_nsdl_dpid       = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 12),'')
          SET @@L_COMPM_cdsl_dpid       = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 13),'')
          SET @@L_COMPM_PAN_NO          = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 14),'')
          SET @@L_COMPM_SEBI_REG_NO     = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 15),'')
          SET @@L_COMPM_SERTAX_REGNO    = ISNULL(citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 16),'')
          
          SET @@L_COMPM_RMKS            = citrus_usr.FN_SPLITVAL(@@CURRSTRING_VAL, 17)
          --
          IF @PA_ACTION = 'INS'  --ACTION TYPE = INS BEGINS HERE
          BEGIN --#5
          --
            IF @PA_CHK_YN = 0  --IF MAKER CHECKER FUNCTIONALITY IS NOT REQD
            BEGIN --#6
            --
              SELECT @@L_COMPM_ID = ISNULL(MAX(COMPM_ID),0) + 1
              FROM COMPANY_MSTR WITH (NOLOCK)
              --
              BEGIN TRANSACTION
              --
              INSERT INTO COMPANY_MSTR
              (COMPM_ID
              ,COMPM_NAME1 
														,COMPM_SHORT_NAME 
														,COMPM_TYPE 
														,COMPM_NSECM_MEM_CD 
														,COMPM_NSEFO_MEM_CD 
														,COMPM_BSECM_MEM_CD 
														,COMPM_BSEFO_MEM_CD 
														,COMPM_Ncdex_MEM_CD 
														,COMPM_mcx_MEM_CD 
														,COMPM_dgcx_MEM_CD 
														,COMPM_nmc_MEM_CD 
														,COMPM_nsdl_dpid 
														,COMPM_cdsl_dpid 
														,COMPM_PAN_NO 
														,COMPM_SERTAX_REGNO 
														,COMPM_SEBI_REG_NO 
														,COMPM_RMKS       
														,COMPM_CREATED_BY 
														,COMPM_CREATED_DT 
														,COMPM_LST_UPD_BY 
														,COMPM_LST_UPD_DT 
														,COMPM_DELETED_IND
														)
              VALUES
              (@@L_COMPM_ID
              ,@@L_COMPM_NAME1
              ,@@L_COMPM_SHORT_NAME
              ,@@L_COMPM_TYPE 
														,@@L_COMPM_NSECM_MEM_CD 
														,@@L_COMPM_NSEFO_MEM_CD 
														,@@L_COMPM_BSECM_MEM_CD 
														,@@L_COMPM_BSEFO_MEM_CD 
														,@@L_COMPM_Ncdex_MEM_CD 
														,@@L_COMPM_mcx_MEM_CD 
														,@@L_COMPM_dgcx_MEM_CD 
														,@@L_COMPM_nmc_MEM_CD 
														,@@L_COMPM_nsdl_dpid 
														,@@L_COMPM_cdsl_dpid 
														,@@L_COMPM_PAN_NO
														,@@L_COMPM_SERTAX_REGNO
              ,@@L_COMPM_SEBI_REG_NO
              ,@@L_COMPM_RMKS
              ,@PA_LOGIN_NAME
              ,GETDATE()
              ,@PA_LOGIN_NAME
              ,GETDATE()
              ,1
              )
              --
              SET @@L_ERROR = @@ERROR
              --
              IF @@L_ERROR  > 0
              BEGIN
              --
                ROLLBACK TRANSACTION
                --
                --SET @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_VAL,'')+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
                SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
              --
              END
              ELSE
              BEGIN
              --
                COMMIT TRANSACTION
              --
             END
            --
            END--#6
            --
            IF @PA_CHK_YN = 1 -- IF MAKER IS INSERTING
            BEGIN --#7
            --
              BEGIN TRANSACTION
              --
              SELECT @@L_COMPMM_ID = ISNULL(MAX(CMM.COMPM_ID), 0)+1
              FROM COMPANY_MSTR_MAK CMM WITH (NOLOCK)
              --
              SELECT @@L_COMPM_ID  = ISNULL(MAX(CM.COMPM_ID), 0)+1
              FROM COMPANY_MSTR CM WITH (NOLOCK)
              --
              IF @@L_COMPMM_ID > @@L_COMPM_ID
              BEGIN
              --
                SET  @@L_COMPM_ID = @@L_COMPMM_ID
              --
              END
              --
              INSERT INTO COMPANY_MSTR_MAK
              (COMPM_ID
														,COMPM_NAME1 
														,COMPM_SHORT_NAME 
														,COMPM_TYPE 
														,COMPM_NSECM_MEM_CD 
														,COMPM_NSEFO_MEM_CD 
														,COMPM_BSECM_MEM_CD 
														,COMPM_BSEFO_MEM_CD 
														,COMPM_Ncdex_MEM_CD 
														,COMPM_mcx_MEM_CD 
														,COMPM_dgcx_MEM_CD 
														,COMPM_nmc_MEM_CD 
														,COMPM_nsdl_dpid 
														,COMPM_cdsl_dpid 
														,COMPM_PAN_NO 
														,COMPM_SERTAX_REGNO 
														,COMPM_SEBI_REG_NO 
														,COMPM_RMKS       
														,COMPM_CREATED_BY 
														,COMPM_CREATED_DT 
														,COMPM_LST_UPD_BY 
														,COMPM_LST_UPD_DT 
														,COMPM_DELETED_IND
														)
														VALUES
														(@@L_COMPM_ID
														,@@L_COMPM_NAME1
														,@@L_COMPM_SHORT_NAME
														,@@L_COMPM_TYPE 
														,@@L_COMPM_NSECM_MEM_CD 
														,@@L_COMPM_NSEFO_MEM_CD 
														,@@L_COMPM_BSECM_MEM_CD 
														,@@L_COMPM_BSEFO_MEM_CD 
														,@@L_COMPM_Ncdex_MEM_CD 
														,@@L_COMPM_mcx_MEM_CD 
														,@@L_COMPM_dgcx_MEM_CD 
														,@@L_COMPM_nmc_MEM_CD 
														,@@L_COMPM_nsdl_dpid 
														,@@L_COMPM_cdsl_dpid 
														,@@L_COMPM_PAN_NO
														,@@L_COMPM_SERTAX_REGNO
														,@@L_COMPM_SEBI_REG_NO
														,@@L_COMPM_RMKS
														,@PA_LOGIN_NAME
														,GETDATE()
														,@PA_LOGIN_NAME
														,GETDATE()
														,0
              )
              --
              SET @@L_ERROR = @@ERROR
              --
              IF @@L_ERROR  > 0
              BEGIN
              --
                ROLLBACK TRANSACTION
                --
                --SET @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_VAL,'')+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
                SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
              --
              END
              ELSE
              BEGIN
              --
                COMMIT TRANSACTION
              --
              END
            --
            END --#7
          --
          END --#5
          --
          IF @PA_ACTION = 'EDT'
          BEGIN
          --
             IF @PA_CHK_YN = 0 -- IF NO MAKER CHECKER
             BEGIN --#CHK_YN = 0
             --
               BEGIN TRANSACTION
               --
               UPDATE COMPM WITH (ROWLOCK)
               SET   COMPM_NAME1                 = @@L_COMPM_NAME1                
																				,COMPM_SHORT_NAME            = @@L_COMPM_SHORT_NAME 
																				,COMPM_TYPE                  = @@L_COMPM_TYPE  
																				,COMPM_NSECM_MEM_CD          = @@L_COMPM_NSECM_MEM_CD   
																				,COMPM_NSEFO_MEM_CD          = @@L_COMPM_NSEFO_MEM_CD 
																				,COMPM_BSECM_MEM_CD          = @@L_COMPM_BSECM_MEM_CD 
																				,COMPM_BSEFO_MEM_CD          = @@L_COMPM_BSEFO_MEM_CD 
																				,COMPM_Ncdex_MEM_CD          = @@L_COMPM_Ncdex_MEM_CD 
																				,COMPM_mcx_MEM_CD            = @@L_COMPM_mcx_MEM_CD 
																				,COMPM_dgcx_MEM_CD           = @@L_COMPM_dgcx_MEM_CD
																				,COMPM_nmc_MEM_CD            = @@L_COMPM_nmc_MEM_CD 
																				,COMPM_nsdl_dpid             = @@L_COMPM_nsdl_dpid 
																				,COMPM_cdsl_dpid             = @@L_COMPM_cdsl_dpid 
																				,COMPM_PAN_NO                = @@L_COMPM_PAN_NO 
																				,COMPM_SERTAX_REGNO          = @@L_COMPM_SERTAX_REGNO 
																				,COMPM_SEBI_REG_NO           = @@L_COMPM_SEBI_REG_NO  
                    ,COMPM.COMPM_RMKS            = @@L_COMPM_RMKS
                    ,COMPM.COMPM_LST_UPD_BY      = @PA_LOGIN_NAME
                    ,COMPM.COMPM_LST_UPD_DT      = GETDATE()
               FROM  COMPANY_MSTR COMPM
               WHERE COMPM.COMPM_ID              = CONVERT(INT, @@CURRSTRING_ID)
               --
               SET @@L_ERROR = @@ERROR
               --
               IF @@L_ERROR  > 0
               BEGIN
               --
                 --SET @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_VAL,'')+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
                 SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
                 --
                 ROLLBACK TRANSACTION
               --
               END
               ELSE
               BEGIN
               --
                 COMMIT TRANSACTION
               --
               END
             --
             END --#CHK_YN = 0
             ELSE
             BEGIN--#CHK_YN = 1
             --
               BEGIN TRANSACTION
               --
               UPDATE COMPANY_MSTR_MAK WITH (ROWLOCK)
               SET    COMPM_DELETED_IND = 2
                    , COMPM_LST_UPD_BY  = @PA_LOGIN_NAME
                    , COMPM_LST_UPD_DT  = GETDATE()
               WHERE COMPM_ID = CONVERT(INT, @@CURRSTRING_ID)
               AND   COMPM_DELETED_IND = 0
               --
               SET @@L_ERROR = @@ERROR
               --
               IF @@L_ERROR  > 0
               BEGIN --#1
               --
                 --SET @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_VAL,'')+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
                 SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
                 --
                 ROLLBACK TRANSACTION
               --
               END  --#1
               ELSE
               BEGIN --#2
               --
                 INSERT INTO COMPANY_MSTR_MAK
																		(COMPM_ID
																		,COMPM_NAME1 
																		,COMPM_SHORT_NAME 
																		,COMPM_TYPE 
																		,COMPM_NSECM_MEM_CD 
																		,COMPM_NSEFO_MEM_CD 
																		,COMPM_BSECM_MEM_CD 
																		,COMPM_BSEFO_MEM_CD 
																		,COMPM_Ncdex_MEM_CD 
																		,COMPM_mcx_MEM_CD 
																		,COMPM_dgcx_MEM_CD 
																		,COMPM_nmc_MEM_CD 
																		,COMPM_nsdl_dpid 
																		,COMPM_cdsl_dpid 
																		,COMPM_PAN_NO 
																		,COMPM_SERTAX_REGNO 
																		,COMPM_SEBI_REG_NO 
																		,COMPM_RMKS       
																		,COMPM_CREATED_BY 
																		,COMPM_CREATED_DT 
																		,COMPM_LST_UPD_BY 
																		,COMPM_LST_UPD_DT 
																		,COMPM_DELETED_IND
																		)
																		VALUES
																		(CONVERT(INT, @@CURRSTRING_ID)
																		,@@L_COMPM_NAME1
																		,@@L_COMPM_SHORT_NAME
																		,@@L_COMPM_TYPE 
																		,@@L_COMPM_NSECM_MEM_CD 
																		,@@L_COMPM_NSEFO_MEM_CD 
																		,@@L_COMPM_BSECM_MEM_CD 
																		,@@L_COMPM_BSEFO_MEM_CD 
																		,@@L_COMPM_NCDEX_MEM_CD 
																		,@@L_COMPM_MCX_MEM_CD 
																		,@@L_COMPM_DGCX_MEM_CD 
																		,@@L_COMPM_NMC_MEM_CD 
																		,@@L_COMPM_NSDL_DPID 
																		,@@L_COMPM_CDSL_DPID 
																		,@@L_COMPM_PAN_NO
																		,@@L_COMPM_SERTAX_REGNO
																		,@@L_COMPM_SEBI_REG_NO
																		,@@L_COMPM_RMKS
																		,@PA_LOGIN_NAME
																		,GETDATE()
																		,@PA_LOGIN_NAME
																		,GETDATE()
																		,0
                  )
                 --
                 SET @@L_ERROR = @@ERROR
                 --
                 IF @@L_ERROR  > 0
                 BEGIN
                 --
                   --SET @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_VAL,'')+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,@@L_COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
                   SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
                   --
                   ROLLBACK TRANSACTION
                 --
                 END
                 ELSE
                 BEGIN
                 --
                   COMMIT TRANSACTION
                 --
                 END
               --
               END  --#2
             --
             END  --#CHK_YN = 1
          --
          END   --EDT
        --
        END --#4
      --
      END --#3 END OF WHILE @@REMAININGSTRING_VAL <> ''
      --@PA_ID--

      IF @PA_ACTION = 'DEL'
      BEGIN  --DEL
      --
        BEGIN TRANSACTION
        --
        UPDATE COMPANY_MSTR WITH (ROWLOCK)
        SET    COMPM_DELETED_IND = 0
             , COMPM_LST_UPD_BY = @PA_LOGIN_NAME
             , COMPM_LST_UPD_DT = GETDATE()
        WHERE COMPM_ID = CONVERT(INT, @@CURRSTRING_ID)
        --
        SET @@L_ERROR = @@ERROR
        --
        IF @@L_ERROR  > 0
        BEGIN
        --
          /*SELECT @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_ID,'')+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
          FROM   COMPANY_MSTR WITH (NOLOCK)
          WHERE  COMPM_ID          = CONVERT(INT, @@CURRSTRING_ID)
          AND    COMPM_DELETED_IND = 1*/
          --
          SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
          --
          ROLLBACK TRANSACTION
        --
        END
        ELSE
        BEGIN
        --
          COMMIT TRANSACTION
        --
        END
      --
      END  --DEL
      --
      IF @PA_ACTION = 'REJ'
      BEGIN  --REJ
      --
        BEGIN TRANSACTION
        --
        UPDATE COMPANY_MSTR_MAK WITH (ROWLOCK)
        SET    COMPM_DELETED_IND = 3
             , COMPM_LST_UPD_BY  = @PA_LOGIN_NAME
             , COMPM_LST_UPD_DT  = GETDATE()
        WHERE  COMPM_ID          = CONVERT(INT,@@CURRSTRING_ID)
        AND    COMPM_DELETED_IND = 0
        --
        SET @@L_ERROR = @@ERROR
        --
        IF @@L_ERROR  > 0
        BEGIN
        --
          /*SELECT @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_ID,'')+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
          FROM   COMPANY_MSTR WITH (NOLOCK)
          WHERE  COMPM_ID          = CONVERT(INT, @@CURRSTRING_ID)
          AND    COMPM_DELETED_IND = 1*/
          SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
          --
          ROLLBACK TRANSACTION
         --
        END
        ELSE
        BEGIN
        --
          COMMIT TRANSACTION
        --
       END
      --
      END   --REJ
      --
      IF @PA_ACTION = 'APP'
      BEGIN --APP
      --
        IF EXISTS(SELECT COMPM_ID
                  FROM   COMPANY_MSTR WITH(NOLOCK)
                  WHERE  COMPM_ID = CONVERT(INT, @@CURRSTRING_ID))
        BEGIN --#EXTS
        --
          BEGIN TRANSACTION
          --
          UPDATE COMPM WITH (ROWLOCK)
          SET   COMPM_NAME1                 = @@L_COMPM_NAME1                
																,COMPM_SHORT_NAME            = @@L_COMPM_SHORT_NAME 
																,COMPM_TYPE                  = @@L_COMPM_TYPE  
																,COMPM_NSECM_MEM_CD          = @@L_COMPM_NSECM_MEM_CD   
																,COMPM_NSEFO_MEM_CD          = @@L_COMPM_NSEFO_MEM_CD 
																,COMPM_BSECM_MEM_CD          = @@L_COMPM_BSECM_MEM_CD 
																,COMPM_BSEFO_MEM_CD          = @@L_COMPM_BSEFO_MEM_CD 
																,COMPM_Ncdex_MEM_CD          = @@L_COMPM_Ncdex_MEM_CD 
																,COMPM_mcx_MEM_CD            = @@L_COMPM_mcx_MEM_CD 
																,COMPM_dgcx_MEM_CD           = @@L_COMPM_dgcx_MEM_CD
																,COMPM_nmc_MEM_CD            = @@L_COMPM_nmc_MEM_CD 
																,COMPM_nsdl_dpid             = @@L_COMPM_nsdl_dpid 
																,COMPM_cdsl_dpid             = @@L_COMPM_cdsl_dpid 
																,COMPM_PAN_NO                = @@L_COMPM_PAN_NO 
																,COMPM_SERTAX_REGNO          = @@L_COMPM_SERTAX_REGNO 
																,COMPM_SEBI_REG_NO           = @@L_COMPM_SEBI_REG_NO  
																,COMPM.COMPM_RMKS            = @@L_COMPM_RMKS
																,COMPM.COMPM_LST_UPD_BY      = @PA_LOGIN_NAME
																,COMPM.COMPM_LST_UPD_DT      = GETDATE()
                ,COMPM.COMPM_DELETED_IND     = 1
          FROM COMPANY_MSTR      COMPM
             , COMPANY_MSTR_MAK  COMPMM
          WHERE COMPM.COMPM_ID             = CONVERT(INT, @@CURRSTRING_ID)
          AND  COMPMM.COMPM_ID             = COMPM.COMPM_ID
          AND  COMPM.COMPM_DELETED_IND     = 1
          AND  COMPMM.COMPM_DELETED_IND    = 0
          AND  COMPMM.COMPM_CREATED_BY <> @PA_LOGIN_NAME
          --
          SET @@L_ERROR = @@ERROR
          --
          IF @@L_ERROR  > 0
          BEGIN --#1A
          --
            /*SELECT @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_ID,'')+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
            FROM  COMPANY_MSTR_MAK WITH (NOLOCK)
            WHERE COMPM_ID          = CONVERT(INT, @@CURRSTRING_ID)
            AND   COMPM_DELETED_IND = 1*/
            SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
            --
            ROLLBACK TRANSACTION
          --
          END  --#1A
          ELSE
          BEGIN --#2A
          --
            UPDATE COMPANY_MSTR_MAK WITH (ROWLOCK)
            SET    COMPM_DELETED_IND  = 1
                 , COMPM_LST_UPD_BY   = @PA_LOGIN_NAME
                 , COMPM_LST_UPD_DT   = GETDATE()
            WHERE  COMPM_ID           = CONVERT(INT, @@CURRSTRING_ID)
            AND    COMPM_CREATED_BY  <> @PA_LOGIN_NAME
            AND    COMPM_DELETED_IND  = 0
            --
            SET @@L_ERROR = @@ERROR
            --
            IF @@L_ERROR  > 0
            BEGIN --#1
            --
              /*SELECT @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_ID,'')+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
              FROM  COMPANY_MSTR_MAK WITH (NOLOCK)
              WHERE COMPM_ID          = CONVERT(INT, @@CURRSTRING_ID)
              AND   COMPM_DELETED_IND = 1*/
              SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
              --
              ROLLBACK TRANSACTION
            --
            END   --#1
            ELSE
            BEGIN --#2
            --
              COMMIT TRANSACTION
            --
            END  --#2
          --
          END --#2A
        --
        END   --#EXTS
        ELSE
        BEGIN --#NOT EXTS
        --
          BEGIN TRANSACTION
          --
          INSERT INTO COMPANY_MSTR
										(COMPM_ID
										,COMPM_NAME1 
										,COMPM_SHORT_NAME 
										,COMPM_TYPE 
										,COMPM_NSECM_MEM_CD 
										,COMPM_NSEFO_MEM_CD 
										,COMPM_BSECM_MEM_CD 
										,COMPM_BSEFO_MEM_CD 
										,COMPM_Ncdex_MEM_CD 
										,COMPM_mcx_MEM_CD 
										,COMPM_dgcx_MEM_CD 
										,COMPM_nmc_MEM_CD 
										,COMPM_nsdl_dpid 
										,COMPM_cdsl_dpid 
										,COMPM_PAN_NO 
										,COMPM_SERTAX_REGNO 
										,COMPM_SEBI_REG_NO 
										,COMPM_RMKS       
										,COMPM_CREATED_BY 
										,COMPM_CREATED_DT 
										,COMPM_LST_UPD_BY 
										,COMPM_LST_UPD_DT 
										,COMPM_DELETED_IND
										)
          SELECT COMPM_ID
										,COMPM_NAME1 
										,COMPM_SHORT_NAME 
										,COMPM_TYPE 
										,COMPM_NSECM_MEM_CD 
										,COMPM_NSEFO_MEM_CD 
										,COMPM_BSECM_MEM_CD 
										,COMPM_BSEFO_MEM_CD 
										,COMPM_Ncdex_MEM_CD 
										,COMPM_mcx_MEM_CD 
										,COMPM_dgcx_MEM_CD 
										,COMPM_nmc_MEM_CD 
										,COMPM_nsdl_dpid 
										,COMPM_cdsl_dpid 
										,COMPM_PAN_NO 
										,COMPM_SERTAX_REGNO 
										,COMPM_SEBI_REG_NO 
										,COMPM_RMKS       
										,COMPM_CREATED_BY 
										,COMPM_CREATED_DT 
          ,@PA_LOGIN_NAME
          ,GETDATE()
          ,1
          FROM  COMPANY_MSTR_MAK    COMPMM WITH (NOLOCK)
          WHERE COMPMM.COMPM_ID          = CONVERT(INT, @@CURRSTRING_ID)
          AND   COMPMM.COMPM_CREATED_BY <> @PA_LOGIN_NAME
          AND   COMPMM.COMPM_DELETED_IND = 0
          --
          SET @@L_ERROR = @@ERROR
          --
          IF @@L_ERROR  > 0
          BEGIN --#001
          --
            /*SELECT @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_ID,'')+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
            FROM  COMPANY_MSTR_MAK WITH (NOLOCK)
            WHERE COMPM_ID          = CONVERT(INT, @@CURRSTRING_ID)
            AND   COMPM_DELETED_IND = 1*/
            SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
            --
            ROLLBACK TRANSACTION
          --
          END --#001
          ELSE
          BEGIN  --#002
          --
            UPDATE COMPANY_MSTR_MAK WITH (ROWLOCK)
            SET COMPM_DELETED_IND = 1
              , COMPM_LST_UPD_BY  = @PA_LOGIN_NAME
              , COMPM_LST_UPD_DT   = GETDATE()
            WHERE COMPM_ID        = CONVERT(INT, @@CURRSTRING_ID)
            AND COMPM_CREATED_BY <> @PA_LOGIN_NAME
            AND COMPM_DELETED_IND = 0
            --
            SET @@L_ERROR = @@ERROR
            --
            IF @@L_ERROR  > 0
            BEGIN   --#003
            --
              /*SELECT @@L_ERRORSTR = ISNULL(@@L_ERRORSTR,'')+ISNULL(@@CURRSTRING_ID,'')+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_NAME3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SHORT_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_MEM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SEBI_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_NAME)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_CD)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_CL_MEM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_SERTAX_REGNO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_PAN_NO)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO1)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO2)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO3)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO4)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REG_NO5)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_TYPE)+@COLDELIMITER+CONVERT(VARCHAR,COMPM_REMISOR_COMP_ID)+@COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
              FROM  COMPANY_MSTR_MAK WITH (NOLOCK)
              WHERE COMPM_ID          = CONVERT(INT, @@CURRSTRING_ID)
              AND   COMPM_DELETED_IND = 1*/
              SET @@L_ERRORSTR = @COLDELIMITER+CONVERT(VARCHAR, @@L_ERROR)+@ROWDELIMITER
              --
              ROLLBACK TRANSACTION
            --
            END    --#003
            ELSE
            BEGIN  --#004
            --
              COMMIT TRANSACTION
            --
            END    --#004
            --
          END   --#002
        --
        END   --#NOT EXTS
      --
      END --APP
    --
    END --#2
   --
  END --#1
  --
  SET @PA_ERRMSG = @@L_ERRORSTR
--
END --#0

GO
