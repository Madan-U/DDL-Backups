-- Object: PROCEDURE citrus_usr.PR_MANUALCHRG_ENTRY
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------

--SELECT * FROM CLIENT_CHARGES_NSDL
--SELECT * FROM CLIENT_CHARGES_CDSL WHERE CLIC_DELETED_IND = 1
--SELECT * FROM DP_CHARGES_NSDL
--SELECT * FROM DP_CHARGES_CDSL
--PR_MANUALCHRG_ENTRY 'nsdl','client','jul 23 2009','jul 23 2010',''
	
CREATE PROC [citrus_usr].[PR_MANUALCHRG_ENTRY]
(
	@PA_DPSEL	VARCHAR(50),
	@PA_SEL		VARCHAR(10),
	@PA_FROMDT  VARCHAR(20), 
	@PA_TODT    VARCHAR(20),
--	@PA_FROMAMT	NUMERIC(18,3),
--	@PA_TOAMT	NUMERIC(18,3),
	@PA_LOGIN	VARCHAR(50) 
)
AS
BEGIN

	IF @PA_SEL = 'CLIENT'
	BEGIN

		IF @PA_DPSEL = 'NSDL'
		BEGIN

			SELECT distinct DPAM_SBA_NO accno,CLIC_CHARGE_NAME chname,CLIC_CHARGE_AMT amt,CLIC_CREATED_BY FROM CLIENT_CHARGES_NSDL,DP_ACCT_MSTR
			WHERE CLIC_DPAM_ID = DPAM_ID
			AND CONVERT(DATETIME,CLIC_TRANS_DT,103) BETWEEN CONVERT(DATETIME,@PA_FROMDT,103) AND CONVERT(DATETIME,@PA_TODT,103)
			--AND CASE WHEN @PA_FROMAMT = '0' THEN '0' ELSE CLIC_CHARGE_AMT END =  LIKE CASE WHEN CONVERT(VARCH@PA_AMOUNT = 0 THEN '%' ELSE @PA_AMOUNT END
			AND ISNULL(CLIC_CREATED_BY,'%') LIKE CASE WHEN @PA_LOGIN = '' THEN '%' ELSE @PA_LOGIN END
			AND CLIC_DELETED_IND = 1
			AND DPAM_DELETED_IND = 1
			--AND   isnull(CONVERT(VARCHAR(12),CLIM_SEBI_REG_DT,103),'%') LIKE CASE WHEN LTRIM(RTRIM(CONVERT(VARCHAR(12),@PA_CLIM_SEBI_REG_DT,103))) = '' THEN '%' ELSE CONVERT(VARCHAR(12),@PA_CLIM_SEBI_REG_DT,103) END          

		END
		
		ELSE
		BEGIN

			SELECT distinct DPAM_SBA_NO accno,CLIC_CHARGE_NAME chname,CLIC_CHARGE_AMT amt,CLIC_CREATED_BY FROM CLIENT_CHARGES_CDSL,DP_ACCT_MSTR
			WHERE CLIC_DPAM_ID = DPAM_ID
			AND CONVERT(DATETIME,CLIC_TRANS_DT,103) BETWEEN CONVERT(DATETIME,@PA_FROMDT,103) AND CONVERT(DATETIME,@PA_TODT,103)
			--AND ISNULL(CLIC_CHARGE_AMT,'%') LIKE CASE WHEN @PA_AMOUNT = '' THEN '%' ELSE @PA_AMOUNT END
			AND ISNULL(CLIC_CREATED_BY,'%') LIKE CASE WHEN @PA_LOGIN = '' THEN '%' ELSE @PA_LOGIN END
			AND CLIC_DELETED_IND = 1
			AND DPAM_DELETED_IND = 1
		
		END
	END

	ELSE
	BEGIN

		IF @PA_DPSEL = 'NSDL'
		BEGIN

			SELECT distinct DPAM_SBA_NO accno,DPCH_CHARGE_NAME chname,DPCH_CHARGE_AMT amt,DPCH_CREATED_BY FROM DP_CHARGES_NSDL,DP_ACCT_MSTR
			WHERE DPCH_DPAM_ID = DPAM_ID
			AND CONVERT(DATETIME,DPCH_TRANC_DT,103) BETWEEN CONVERT(DATETIME,@PA_FROMDT,103) AND CONVERT(DATETIME,@PA_TODT,103)
			--AND ISNULL(DPCH_CHARGE_AMT,'%') LIKE CASE WHEN @PA_AMOUNT = '' THEN '%' ELSE @PA_AMOUNT END
			AND ISNULL(DPCH_CREATED_BY,'%') LIKE CASE WHEN @PA_LOGIN = '' THEN '%' ELSE @PA_LOGIN END
			AND DPCH_DELETED_IND = 1
			AND DPAM_DELETED_IND = 1
			
		END
		
		ELSE
		BEGIN
		
			SELECT distinct DPAM_SBA_NO accno,DPCH_CHARGE_NAME chname,DPCH_CHARGE_AMT amt,DPCH_CREATED_BY FROM DP_CHARGES_CDSL,DP_ACCT_MSTR
			WHERE DPCH_DPAM_ID = DPAM_ID
			AND CONVERT(DATETIME,DPCH_TRANC_DT,103) BETWEEN CONVERT(DATETIME,@PA_FROMDT,103) AND CONVERT(DATETIME,@PA_TODT,103)
			--AND ISNULL(DPCH_CHARGE_AMT,'%') LIKE CASE WHEN @PA_AMOUNT = '' THEN '%' ELSE @PA_AMOUNT END
			AND ISNULL(DPCH_CREATED_BY,'%') LIKE CASE WHEN @PA_LOGIN = '' THEN '%' ELSE @PA_LOGIN END
			AND DPCH_DELETED_IND = 1
			AND DPAM_DELETED_IND = 1
		
		END

	END

END

GO
