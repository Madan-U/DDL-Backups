-- Object: PROCEDURE citrus_usr.pr_Select_BBO_CODE
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------




CREATE PROCEDURE [citrus_usr].[pr_Select_BBO_CODE] --'1203320002506009','SELECT',''
@PA_DPAM_SBA_NO VARCHAR(100), 
@PA_ACTION VARCHAR(20), 
@PA_UPD_ACCP_VALUE VARCHAR(20)    
AS      
BEGIN 

IF @PA_ACTION ='SELECT'
  SELECT  ACCP_VALUE FROM DP_ACCT_MSTR, ACCOUNT_PROPERTIES                       
  WHERE DPAM_SBA_NO = @PA_DPAM_SBA_NO        
  AND ACCP_CLISBA_ID = DPAM_ID     
  AND ACCP_ACCPM_PROP_CD = 'BBO_CODE' AND DPAM_DELETED_IND=1 AND ACCP_DELETED_IND=1

ELSE IF @PA_ACTION ='UPDATE'
IF isnull(@PA_DPAM_SBA_NO,'')<>'' 
BEGIN
  UPDATE T SET  ACCP_VALUE=@PA_UPD_ACCP_VALUE FROM  DP_ACCT_MSTR, ACCOUNT_PROPERTIES T                      
  WHERE DPAM_SBA_NO = @PA_DPAM_SBA_NO        
  AND ACCP_CLISBA_ID = DPAM_ID     
  AND ACCP_ACCPM_PROP_CD = 'BBO_CODE' AND DPAM_DELETED_IND=1 AND ACCP_DELETED_IND=1
  
  UPDATE DP_ACCT_MSTR SET DPAM_BBO_CODE=@PA_UPD_ACCP_VALUE WHERE DPAM_SBA_NO = @PA_DPAM_SBA_NO and ISNULL(DPAM_BBO_CODE,'')<>'' AND DPAM_DELETED_IND=1
  END

END

GO
