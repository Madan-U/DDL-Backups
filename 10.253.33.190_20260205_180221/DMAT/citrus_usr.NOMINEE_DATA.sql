-- Object: PROCEDURE citrus_usr.NOMINEE_DATA
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------


CREATE PROC [CITRUS_USR].[NOMINEE_DATA] (@BOID VARCHAR(16) ,@PARTY_CODE VARCHAR(10))   
AS    

IF @BOID <> ''

   BEGIN

  SELECT CLIENT_CODE,NISE_PARTY_CODE INTO #CLIENT FROM TBL_CLIENT_MASTER (NOLOCK) WHERE CLIENT_CODE =@BOID
	 AND STATUS='ACTIVE'

	 SELECT * INTO #BOID FROM DPS8_PC6 (NOLOCK) WHERE BOID IN (SELECT CLIENT_CODE FROM #CLIENT)

SELECT NISE_PARTY_CODE AS PARTY_CODE,CLIENT_CODE AS DPID,
LTRIM(RTRIM(TITLE))+'.'+LTRIM(RTRIM(NAME))+' '+LTRIM(RTRIM(MIDDLENAME))	+' '+ LTRIM(RTRIM(SEARCHNAME)) AS NOMINEE_NAME FROM    
(SELECT  * FROM #BOID WHERE ISNULL(NOM_SR_NO,'0') IN ('0','1') )A    
 INNER JOIN     
 (SELECT BOID,MAX(DATEOFSETUP) AS SDDATE FROM #BOID GROUP BY BOID  )B     
ON A.BOID=B.BOID AND SDDATE =DATEOFSETUP ,#CLIENT C
WHERE  A.BOID = @BOID  AND A.BOID=C.CLIENT_CODE

DROP TABLE #BOID

DROP TABLE #CLIENT

 RETURN
 END

 IF @PARTY_CODE <>'' 
    
	 BEGIN  
	 
	 SELECT CLIENT_CODE,NISE_PARTY_CODE INTO #CLIENT1 FROM TBL_CLIENT_MASTER (NOLOCK) WHERE NISE_PARTY_CODE =@PARTY_CODE
	 AND STATUS='ACTIVE'

	 SELECT * INTO #BOID1 FROM DPS8_PC6 (NOLOCK) WHERE BOID IN (SELECT CLIENT_CODE FROM #CLIENT1)

SELECT NISE_PARTY_CODE AS PARTY_CODE,CLIENT_CODE AS DPID,LTRIM(RTRIM(TITLE))+'.'+LTRIM(RTRIM(NAME))+' '+LTRIM(RTRIM(MIDDLENAME))	+' '+ LTRIM(RTRIM(SEARCHNAME)) AS NOMINEE_NAME FROM    
(SELECT  * FROM #BOID1 WHERE ISNULL(NOM_SR_NO,'0') IN ('0','1') )A    
 INNER JOIN     
 (SELECT BOID,MAX(DATEOFSETUP) AS SDDATE FROM #BOID1 GROUP BY BOID  )B     
ON A.BOID=B.BOID AND SDDATE =DATEOFSETUP ,#CLIENT1 C
WHERE  A.BOID = @BOID  AND A.BOID=C.CLIENT_CODE


DROP TABLE #BOID1

DROP TABLE #CLIENT1

END

GO
