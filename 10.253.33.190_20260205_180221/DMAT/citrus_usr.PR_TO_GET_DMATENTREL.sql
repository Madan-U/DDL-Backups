-- Object: PROCEDURE citrus_usr.PR_TO_GET_DMATENTREL
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------



CREATE PROCEDURE [citrus_usr].[PR_TO_GET_DMATENTREL]
(@PA_BOID VARCHAR(16))
AS
BEGIN

CREATE TABLE #TMP (BOID VARCHAR(16),REGION VARCHAR(100),AREA VARCHAR(50),BRANCH VARCHAR(100),BA VARCHAR(100),REMISSOR VARCHAR(100),ONWARD VARCHAR(100))


insert into #TMP
select @PA_BOID,'','','','','',''

UPDATE #TMP SET REGION= ENTM_SHORT_NAME FROM ENTITY_RELATIONSHIP,DP_ACCT_MSTR,ENTITY_MSTR,#TMP WHERE ENTR_SBA=DPAM_SBA_NO
AND GETDATE() BETWEEN ENTR_FROM_DT  AND 
ISNULL(ENTR_TO_DT,'2100-01-01 00:00:00.000') AND ENTR_SBA=@PA_BOID AND BOID=DPAM_SBA_NO
AND ENTR_DELETED_IND=1 
AND DPAM_DELETED_IND=1
AND ENTM_ID=ENTR_RE


UPDATE #TMP SET AREA= ENTM_SHORT_NAME FROM ENTITY_RELATIONSHIP,DP_ACCT_MSTR,ENTITY_MSTR,#TMP WHERE ENTR_SBA=DPAM_SBA_NO
AND GETDATE() BETWEEN ENTR_FROM_DT  AND 
ISNULL(ENTR_TO_DT,'2100-01-01 00:00:00.000') AND ENTR_SBA=@PA_BOID AND BOID=DPAM_SBA_NO
AND ENTR_DELETED_IND=1
AND DPAM_DELETED_IND=1
AND ENTM_ID=ENTR_AR

UPDATE #TMP SET BRANCH= ENTM_SHORT_NAME  FROM ENTITY_RELATIONSHIP,DP_ACCT_MSTR,ENTITY_MSTR,#TMP WHERE ENTR_SBA=DPAM_SBA_NO
AND GETDATE() BETWEEN ENTR_FROM_DT AND 
ISNULL(ENTR_TO_DT,'2100-01-01 00:00:00.000') AND ENTR_SBA=@PA_BOID AND BOID=DPAM_SBA_NO
AND ENTR_DELETED_IND=1
AND DPAM_DELETED_IND=1
AND ENTM_ID=ENTR_BR

UPDATE #TMP SET BA= ENTM_SHORT_NAME FROM ENTITY_RELATIONSHIP,DP_ACCT_MSTR,ENTITY_MSTR,#TMP WHERE ENTR_SBA=DPAM_SBA_NO
AND GETDATE() BETWEEN ENTR_FROM_DT  AND 
ISNULL(ENTR_TO_DT,'2100-01-01 00:00:00.000') AND ENTR_SBA=@PA_BOID AND BOID=DPAM_SBA_NO
AND ENTR_DELETED_IND=1
AND DPAM_DELETED_IND=1
AND ENTM_ID=ENTR_SB

UPDATE #TMP SET REMISSOR= ENTM_SHORT_NAME  FROM ENTITY_RELATIONSHIP,DP_ACCT_MSTR,ENTITY_MSTR,#TMP WHERE ENTR_SBA=DPAM_SBA_NO
AND GETDATE() BETWEEN ENTR_FROM_DT  AND 
ISNULL(ENTR_TO_DT,'2100-01-01 00:00:00.000') AND ENTR_SBA=@PA_BOID AND BOID=DPAM_SBA_NO
AND ENTR_DELETED_IND=1
AND DPAM_DELETED_IND=1
AND ENTM_ID=ENTR_DUMMY1

UPDATE #TMP SET ONWARD = ENTM_SHORT_NAME  FROM ENTITY_RELATIONSHIP,DP_ACCT_MSTR,ENTITY_MSTR,#TMP WHERE ENTR_SBA=DPAM_SBA_NO
AND GETDATE() BETWEEN ENTR_FROM_DT  AND 
ISNULL(ENTR_TO_DT,'2100-01-01 00:00:00.000') AND ENTR_SBA=@PA_BOID AND BOID=DPAM_SBA_NO
AND ENTR_DELETED_IND=1
AND DPAM_DELETED_IND=1
AND ENTM_ID=ENTR_DUMMY3

SELECT * FROM #TMP

END

GO
