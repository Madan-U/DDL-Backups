-- Object: PROCEDURE citrus_usr.PR_ONLINE_DPTRX_BEN
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------

CREATE PROCEDURE [citrus_usr].[PR_ONLINE_DPTRX_BEN]
(
@PA_ONL_ACTION VARCHAR(20)
,@PA_ONL_TRXFEREE_DPID VARCHAR(8)
,@PA_ONL_CMBPID VARCHAR(8)
,@PA_ONL_TRXFEREE_DPNAME VARCHAR(100)
,@PA_ONL_TRXFEREE_BOID VARCHAR(16)
,@PA_ONL_TRXFEREE_BONAME VARCHAR(100)
,@PA_ONL_OTP VARCHAR(5)
,@PA_ONL_LOGIN_NAMES VARCHAR(30)
,@PA_ONL_CREATED_BY VARCHAR(50)
,@PA_ONL_CREATED_DT DATETIME
,@PA_ONL_LST_UPD_BY VARCHAR(50)
,@PA_ONL_LST_UPD_DT DATETIME
,@PA_ONL_DELETED_IND SMALLINT
,@PA_ONL_TRX_BOID VARCHAR(16)
,@PA_ONL_mobile_email VARCHAR(100)
)
AS 
BEGIN

set @PA_ONL_TRXFEREE_DPNAME = replace (@PA_ONL_TRXFEREE_DPNAME,'''','')
declare @bo_name varchar(1000) 

select @bo_name = DPAM_SBA_NAME from dp_acct_mstr where DPAM_SBA_NO = @PA_ONL_TRX_BOID and DPAM_DELETED_IND = 1 

IF @PA_ONL_ACTION='INS'
BEGIN
IF NOT EXISTS(SELECT 1 FROM ONLINE_DPTRX_BEN_MSTR WHERE ONL_TRXFEREE_DPID=@PA_ONL_TRXFEREE_DPID and ONL_CMBPID =@PA_ONL_CMBPID AND ONL_TRXFEREE_BONAME= @PA_ONL_TRXFEREE_BONAME AND ONL_TRXFEREE_BOID=@PA_ONL_TRXFEREE_BOID AND ONL_DELETED_IND=1 and ONL_TRX_BOID = @PA_ONL_TRX_BOID)
BEGIN
INSERT INTO ONLINE_DPTRX_BEN_MSTR (ONL_TRX_BOID,ONL_TRX_BONAME,ONL_TRXFEREE_DPID
,ONL_CMBPID
,ONL_TRXFEREE_DPNAME
,ONL_TRXFEREE_BOID
,ONL_TRXFEREE_BONAME
,ONL_OTP
,ONL_CREATED_BY
,ONL_CREATED_DT
,ONL_LST_UPD_BY
,ONL_LST_UPD_DT
,ONL_DELETED_IND,ONL_BEN_Mobile_email)
SELECT 
@PA_ONL_TRX_BOID,@bo_name
,@PA_ONL_TRXFEREE_DPID
,@PA_ONL_CMBPID 
,@PA_ONL_TRXFEREE_DPNAME 
,@PA_ONL_TRXFEREE_BOID 
,@PA_ONL_TRXFEREE_BONAME 
,@PA_ONL_OTP 
,@PA_ONL_LOGIN_NAMES 
,GETDATE() 
,@PA_ONL_LOGIN_NAMES 
,GETDATE() 
,'1',@PA_ONL_mobile_email

END 
else
begin
select 'AlReady Exists' result
end
END

IF @PA_ONL_ACTION='DEL'
BEGIN
--IF EXISTS(SELECT 1 FROM ONLINE_DPTRX_BEN_MSTR WHERE (ONL_TRXFEREE_DPID=@PA_ONL_TRXFEREE_DPID OR ONL_CMBPID =@PA_ONL_CMBPID)  AND ONL_TRXFEREE_BOID=@PA_ONL_TRXFEREE_BOID AND ONL_DELETED_IND=1)
--BEGIN
UPDATE ONLINE_DPTRX_BEN_MSTR SET ONL_DELETED_IND=9,ONL_LST_UPD_BY=@PA_ONL_LOGIN_NAMES,ONL_LST_UPD_DT=GETDATE() 
WHERE (ONL_TRXFEREE_DPID=@PA_ONL_TRXFEREE_DPID OR ONL_CMBPID =@PA_ONL_CMBPID)
 AND ONL_TRX_BOID =@PA_ONL_TRX_BOID AND ONL_TRXFEREE_BOID=@PA_ONL_TRXFEREE_BOID AND ONL_DELETED_IND=1

--END 
END

IF @PA_ONL_ACTION='CHKEXIST'
  BEGIN
     If @PA_ONL_TRXFEREE_DPID <> ''
    BEGIN
     IF EXISTS(SELECT 1 FROM ONLINE_DPTRX_BEN_MSTR WHERE (ONL_TRXFEREE_DPID=@PA_ONL_TRXFEREE_DPID) AND ONL_TRX_BOID =@PA_ONL_TRX_BOID  AND ONL_TRXFEREE_BOID=@PA_ONL_TRXFEREE_BOID AND ONL_DELETED_IND=1)
 
      begin
       select 'AlReady Exists' result
      END 
    END

else IF @PA_ONL_CMBPID <>''
   begin
     IF EXISTS(SELECT 1 FROM ONLINE_DPTRX_BEN_MSTR WHERE (ONL_CMBPID =@PA_ONL_CMBPID) AND ONL_TRX_BOID =@PA_ONL_TRX_BOID  AND ONL_DELETED_IND=1)
      BEGIN
        select 'AlReady Exists' result
      END 
   end
else
   begin 
     Select 'Not Exist'   result   
   end 





END

end

GO
