-- Object: FUNCTION citrus_usr.FN_CONSIDERATIONAMT
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------

--drop   FUNCTION [citrus_usr].[FN_CONSIDERATIONAMT]
CREATE  FUNCTION [citrus_usr].[FN_CONSIDERATIONAMT](@PA_ACTION VARCHAR(25),@PA_INTREF NUMERIC)
RETURNS VARCHAR(800)
AS
BEGIN
DECLARE @L_TOTAL NUMERIC(16,3),@L_RMKS VARCHAR(800),@L_COMMON VARCHAR(800)
IF @PA_ACTION='CAMT'
BEGIN
SELECT  @L_TOTAL= case when dptdc_line_no='' then '0' else isnull (replace(replace(replace(dptdc_line_no,',',''),'/',''),'-',''),'0') end 
--CONVERT(NUMERIC(16,3),(-1*DPTDC_QTY*( SELECT TOP 1 CLOPM_CDSL_RT FROM CLOSING_PRICE_MSTR_CDSL WHERE CLOPM_ISIN_CD = DPTDC_ISIN 
--AND CLOPM_DT <= DPTDC_EXECUTION_DT AND CLOPM_DELETED_IND = 1  ORDER BY CLOPM_DT DESC) ))
											     
FROM DP_TRX_DTLS_CDSL with(nolock) WHERE DPTDC_INTERNAL_REF_NO=@PA_INTREF AND DPTDC_DELETED_IND=1
SET @L_COMMON= CONVERT(VARCHAR,@L_TOTAL)
END
IF @PA_ACTION='RMKS'
BEGIN
SELECT  @L_RMKS=case when dptdc_line_no='' then '0' else isnull(dptdc_line_no,'0') end 
--ISNULL(DPTDC_RMKS,'')											     
FROM DP_TRX_DTLS_CDSL with(nolock) WHERE DPTDC_INTERNAL_REF_NO=@PA_INTREF AND DPTDC_DELETED_IND=1
SET @L_COMMON= CONVERT(VARCHAR,@L_RMKS)
END
RETURN @L_COMMON
END

GO
