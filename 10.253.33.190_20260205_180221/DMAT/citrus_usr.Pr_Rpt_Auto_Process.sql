-- Object: PROCEDURE citrus_usr.Pr_Rpt_Auto_Process
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------

--EXEC PR_RPT_AUTO_PROCESS 'jun 30 2016' ,'jun 30 2016','HO'       
CREATE  PROCEDURE [citrus_usr].[Pr_Rpt_Auto_Process]      
(@pa_from_dt datetime    
,@pa_to_dt datetime    
,@pa_login_name varchar(100)  )      
AS      
BEGIN      
SELECT PROCESS_TYPE,PROCESS_HALTED_REASON,convert(varchar(20),PROCESS_STARTED_DATE,13) PROCESS_STARTED_DATE,      
 convert(varchar(20),PROCESS_ENDED_DATE,13) PROCESS_ENDED_DATE      
FROM TBL_AUTO_PROCESS_DETAIL WHERE PROCESS_DATE=@pa_from_dt    
UNION 

SELECT PROCESS_TYPE,PROCESS_HALTED_REASON,CONVERT(VARCHAR(20),PROCESS_STARTED_DATE,13) PROCESS_STARTED_DATE,      
 CONVERT(VARCHAR(20),PROCESS_ENDED_DATE,13) PROCESS_ENDED_DATE      
FROM TBL_AUTO_PROCESS_DETAIL_HST O WHERE PROCESS_DATE=@pa_from_dt
AND NOT EXISTS(
SELECT I.PROCESS_TYPE  FROM TBL_AUTO_PROCESS_DETAIL I WHERE i.PROCESS_DATE=@pa_from_dt AND O.PROCESS_TYPE=I.PROCESS_TYPE
--AND O.PROCESS_HALTED_REASON=I.PROCESS_HALTED_REASON
and o.PROCESS_DATE=i.PROCESS_DATE
)
ORDER BY PROCESS_STARTED_DATE
  
--AND PROCESS_FOR LIKE 'CD%'      
--AND PROCESS_FOR NOT LIKE 'CD12%'      
END

GO
