-- Object: PROCEDURE citrus_usr.Pr_bulk_Prop
-- Server: 10.253.33.190 | DB: DMAT
--------------------------------------------------

CREATE PROCEDURE [citrus_usr].[PR_BULK_PROP]  
(  
@PA_LOGINNAMES VARCHAR(50)  
)  
AS  
BEGIN  
DECLARE @C_CLIENT_SUMMARY1  CURSOR    
,@C_BEN_ACCT_NO1  VARCHAR(20)    
,@C_ACCP_VALUE VARCHAR(8000)    
,@L_ACCP_VALUE varchar(800)
,@L_ACCP_CODE VARCHAR(8000)   
,@L_DPAM_ID NUMERIC     
,@L_CRN_NO NUMERIC    
  
SET @C_CLIENT_SUMMARY1 =CURSOR FAST_FORWARD FOR  
  
SELECT PROPBULK_BOID,PROPBULK_VALUE,PROPBULK_CODE FROM TMP_PROP_BULK  
  
OPEN @C_CLIENT_SUMMARY1  
  
FETCH NEXT FROM @C_CLIENT_SUMMARY1 INTO @C_BEN_ACCT_NO1,@C_ACCP_VALUE,@L_ACCP_CODE  
  
WHILE @@FETCH_STATUS=0  
  
BEGIN  
  
SELECT DISTINCT @L_ACCP_VALUE = CONVERT(VARCHAR,ACCPM_PROP_ID) + '|*~|' + CONVERT(VARCHAR(100),@C_ACCP_VALUE) + '|*~|*|~*'     
FROM TMP_PROP_BULK ,ACCOUNT_PROPERTY_MSTR      
WHERE PROPBULK_BOID  = @C_BEN_ACCT_NO1     
AND ACCPM_PROP_CD   = @L_ACCP_CODE    

SET @L_DPAM_ID = 0     
    
SELECT @L_DPAM_ID = DPAM_ID , @L_CRN_NO = DPAM_CRN_NO FROM DP_ACCT_MSTR WHERE DPAM_SBA_NO =  @C_BEN_ACCT_NO1  
print @L_DPAM_ID  
print @L_ACCP_VALUE 
EXEC PR_INS_UPD_ACCP @L_CRN_NO ,'EDT','MIG',@L_DPAM_ID,@C_BEN_ACCT_NO1,'DP',@L_ACCP_VALUE,'' ,0,'*|~*','|*~|',''    
FETCH NEXT FROM @C_CLIENT_SUMMARY1 INTO @C_BEN_ACCT_NO1,@C_ACCP_VALUE,@L_ACCP_CODE  
END  
CLOSE @C_CLIENT_SUMMARY1  
DEALLOCATE @C_CLIENT_SUMMARY1  
END

GO
