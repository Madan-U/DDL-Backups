-- Object: PROCEDURE citrus_usr.PR_RPT_SLIP_TRACKER
-- Server: 10.253.33.227 | DB: DMAT
--------------------------------------------------

--SELECT * FROM DP_MSTR WHERE DEFAULT_DP=DPM_EXCSM_ID
--[PR_RPT_SLIP_TRACKER] '4','INW_FROM_VENDOR_PENDING','','nsdl','',''

CREATE PROCEDURE [citrus_usr].[PR_RPT_SLIP_TRACKER]
(
 @PA_EXCSM_ID NUMERIC
,@PA_TAB VARCHAR(50)
,@PA_PO VARCHAR(25)
,@PA_FILLER1 VARCHAR(50)
,@PA_FILLER2 VARCHAR(50)
,@PA_FILLER3 VARCHAR(50)
)
AS 
BEGIN 
DECLARE @@DPM_ID VARCHAR(80)
SELECT @@DPM_ID = DPM_ID FROM DP_MSTR WHERE DEFAULT_DP = @PA_EXCSM_ID AND DPM_DELETED_IND = 1

IF @PA_TAB='INW_FROM_VENDOR_PENDING'
BEGIN

SELECT (SELECT TOP 1 ISNULL(ORS_PO_NO,'') ORS_PO_NO  FROM ORDER_SLIP WHERE ORS_TRATM_ID = SLIBM_TRATM_ID 
AND SLIBM_BOOK_NAME 
BETWEEN ORS_FROM_NO AND ORS_TO_NO AND ORD_DELETED_IND = 1 AND ISNULL(ORS_PO_NO,'') LIKE @PA_PO + '%') PO_NOS  --ISNULL(ORS_PO_NO,'') LIKE @PA_PO + '%') PO_NOS --ors_po_no = case when @PA_PO = 'ALL' then '%' else @PA_PO end 
,SLIBM_BOOK_NAME
,SLIBM_SERIES_TYPE
,SLIBM_FROM_NO
,SLIBM_TO_NO
,SLIBM_TRATM_ID ,TRASTM_DESC DESCP
FROM SLIP_BOOK_MSTR,TRANSACTION_TYPE_MSTR,TRANSACTION_SUB_TYPE_MSTR
--,CITRUS_USR.FN_GETSUBTRANSDTLS('SLIP_TYPE_CDSL') CD
WHERE 
TRANTM_ID = TRASTM_TRATM_ID
AND SLIBM_TRATM_ID = TRASTM_ID 
AND TRANTM_CODE = CASE WHEN @PA_FILLER1='NSDL' THEN 'SLIP_TYPE_NSDL' ELSE 'SLIP_TYPE_CDSL' END 
AND 
NOT EXISTS(SELECT SLIIM_SLIP_NO_FR , SLIIM_SLIP_NO_TO,  SLIIM_SERIES_TYPE,SLIIM_TRATM_ID 
 FROM SLIP_ISSUE_MSTR 
				 WHERE SLIIM_SLIP_NO_FR = SLIBM_FROM_NO 
				 AND  SLIIM_SLIP_NO_TO  = SLIBM_TO_NO 
                 AND  SLIIM_SERIES_TYPE = SLIBM_SERIES_TYPE AND SLIBM_TRATM_ID = SLIIM_TRATM_ID 
AND SLIIM_DELETED_IND = 1 )
AND SLIBM_DELETED_IND =1 
AND SLIBM_DPM_ID=@@DPM_ID
ORDER BY 1 
END

END
----select * from dp_mstr where dpm_excsm_id=default_dp
--
--select * from CITRUS_USR.FN_GETSUBTRANSDTLS('SLIP_TYPE_cdsl')
--
--select * from transaction_sub_type_mstr where TRASTM_cD='904_act'
--select * from transaction_type_mstr where trantm_code='SLIP_TYPE_cdsl'
--
---- --

GO
