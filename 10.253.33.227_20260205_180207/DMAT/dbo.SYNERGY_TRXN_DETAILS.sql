-- Object: VIEW dbo.SYNERGY_TRXN_DETAILS
-- Server: 10.253.33.227 | DB: DMAT
--------------------------------------------------


   
  
CREATE VIEW [dbo].[SYNERGY_TRXN_DETAILS]  
AS  

/*
SELECT CDSHM_TRAS_DT TD_CURDATE, cdshm_ben_Acct_no TD_AC_CODE, cdshm_isin TD_ISIN_CODE,     
  CASE     
  WHEN cdshm_qty < 0    
   THEN cdshm_qty * - 1    
  ELSE cdshm_qty    
  END TD_QTY, '' TD_CLEAR_CORPN, LEFT(CDSHM_COUNTER_DPID, 16) TD_COUNTERDP, LEFT(ISNULL(CDSHM_COUNTER_BOID, CDSHM_COUNTER_DPID), 16) TD_BENEFICIERY, CDSHM_TRANS_NO TD_REFERENCE, LEFT(REPLACE(cdshm_tratm_type_desc, 'FILE', ''), 100) TD_DESCRIPTION, NULL TD
_CATEGORY, NULL TD_AC_TYPE, NULL TD_NARRATION, NULL TD_BOOKING_TYPE, CDSHM_SETT_TYPE TD_MARKET_TYPE, CDSHM_SETT_NO TD_SETTLEMENT, '0' TD_BLOCKED, '00' TD_BLOCKEDCD, NULL TD_RDATE, LEFT(CONVERT(VARCHAR, CDSHM_TRAS_DT, 112), 8) TD_TRXDATE, '' TD_TRXTIME,   
  
  CASE     
  WHEN CDSHM_QTY < 0    
   THEN 'D'    
  ELSE 'C'    
  END TD_DEBIT_CREDIT, cdshm_tratm_cd TD_TRXNO, '' TD_CHARGE_CODE, 0 TD_RATE, 0 TD_AMOUNT, '' TD_INTERNAL_REFNO, '' TD_COUNTERCMBPID, 0 TD_TOTCERT, '' TD_CHARGEFLAG, '' MKRID, '' MKRDT, '' TD_REJCODE, '' TD_BILLCODE, 0 TD_CDSLCHARGE, '' TD_PDCD, '' TD_PDC
ODE, LEFT(CDSHM_TRATM_DESC, 100) TD_REMARKS, 0 TD_ACTUALCDSLCHARGE    
FROM dmat_archival.citrus_usr.CDSL_HOLDING_DTLS WITH (NOLOCK)    
WHERE     
CDSHM_TRAS_DT > '01-OCT-2014' And CDSHM_TRAS_DT <= '31-Mar-2020'     
AND cdshm_tratm_cd IN ('2246', '2277', '2201', '3102', '2270', '2220', '2262', '2251', '2202', '2205')    
    
union all    
    
SELECT CDSHM_TRAS_DT TD_CURDATE, cdshm_ben_Acct_no TD_AC_CODE, cdshm_isin TD_ISIN_CODE,     
  CASE     
  WHEN cdshm_qty < 0    
   THEN cdshm_qty * - 1    
  ELSE cdshm_qty    
  END TD_QTY, '' TD_CLEAR_CORPN, LEFT(CDSHM_COUNTER_DPID, 16) TD_COUNTERDP, LEFT(ISNULL(CDSHM_COUNTER_BOID, CDSHM_COUNTER_DPID), 16) TD_BENEFICIERY, CDSHM_TRANS_NO TD_REFERENCE, LEFT(REPLACE(cdshm_tratm_type_desc, 'FILE', ''), 100) TD_DESCRIPTION, NULL TD
_CATEGORY, NULL TD_AC_TYPE, NULL TD_NARRATION, NULL TD_BOOKING_TYPE, CDSHM_SETT_TYPE TD_MARKET_TYPE, CDSHM_SETT_NO TD_SETTLEMENT, '0' TD_BLOCKED, '00' TD_BLOCKEDCD, NULL TD_RDATE, LEFT(CONVERT(VARCHAR, CDSHM_TRAS_DT, 112), 8) TD_TRXDATE, '' TD_TRXTIME,   
  
  CASE     
  WHEN CDSHM_QTY < 0    
   THEN 'D'    
  ELSE 'C'    
  END TD_DEBIT_CREDIT, cdshm_tratm_cd TD_TRXNO, '' TD_CHARGE_CODE, 0 TD_RATE, 0 TD_AMOUNT, '' TD_INTERNAL_REFNO, '' TD_COUNTERCMBPID, 0 TD_TOTCERT, '' TD_CHARGEFLAG, '' MKRID, '' MKRDT, '' TD_REJCODE, '' TD_BILLCODE, 0 TD_CDSLCHARGE, '' TD_PDCD, '' TD_PDC
ODE, LEFT(CDSHM_TRATM_DESC, 100) TD_REMARKS, 0 TD_ACTUALCDSLCHARGE    
FROM dmat.citrus_usr.CDSL_HOLDING_DTLS WITH (NOLOCK)    
WHERE     
CDSHM_TRAS_DT > '31-Mar-2020' And    
cdshm_tratm_cd IN ('2246', '2277', '2201', '3102', '2270', '2220', '2262', '2251', '2202', '2205')    */

SELECT CDSHM_TRAS_DT TD_CURDATE, cdshm_ben_Acct_no TD_AC_CODE, cdshm_isin TD_ISIN_CODE,   
  CASE   
  WHEN cdshm_qty < 0  
   THEN cdshm_qty * - 1  
  ELSE cdshm_qty  
  END TD_QTY, '' TD_CLEAR_CORPN, LEFT(CDSHM_COUNTER_DPID, 16) TD_COUNTERDP, LEFT(ISNULL(CDSHM_COUNTER_BOID, CDSHM_COUNTER_DPID), 16) TD_BENEFICIERY, CDSHM_TRANS_NO TD_REFERENCE, LEFT(REPLACE(cdshm_tratm_type_desc, 'FILE', ''), 100) TD_DESCRIPTION, NULL TD_CATEGORY, NULL TD_AC_TYPE, NULL TD_NARRATION, NULL TD_BOOKING_TYPE, CDSHM_SETT_TYPE TD_MARKET_TYPE, CDSHM_SETT_NO TD_SETTLEMENT, '0' TD_BLOCKED, '00' TD_BLOCKEDCD, NULL TD_RDATE, LEFT(CONVERT(VARCHAR, CDSHM_TRAS_DT, 112), 8) TD_TRXDATE, '' TD_TRXTIME,   
  CASE   
  WHEN CDSHM_QTY < 0  
   THEN 'D'  
  ELSE 'C'  
  END TD_DEBIT_CREDIT, cdshm_tratm_cd TD_TRXNO, '' TD_CHARGE_CODE, 0 TD_RATE, 0 TD_AMOUNT, '' TD_INTERNAL_REFNO, '' TD_COUNTERCMBPID, 0 TD_TOTCERT, '' TD_CHARGEFLAG, '' MKRID, '' MKRDT, '' TD_REJCODE, '' TD_BILLCODE, 0 TD_CDSLCHARGE, '' TD_PDCD, '' TD_PDCODE,   
CASE WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='68' THEN ' CA- TRF OF SHARES TO IEPF' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='69' THEN ' CA- TRF OF SHS – NSDL IEPF' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='70' THEN ' CA- TRF OF SHS TO IEPF PHY' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='71' THEN ' CA- TRF OF SHS TO IEPF ACA' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='72' THEN ' CA- SUSPENSE ACCOUNT DEBIT' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,27,'~') IN (1,3) AND CDSHM_CDAS_TRAS_TYPE = '18' THEN ' ACCOUNT TRANSFER' +'-'+   ISNULL(CDSHM_COUNTER_BOID,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,2,'~') ='7' AND CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,25,'~') ='R' THEN 'REMAT REJECT -' +  CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,38,'~')    
 ELSE REPLACE(LEFT(CDSHM_TRATM_DESC, 100),'        ','') END    TD_REMARKS, 0 TD_ACTUALCDSLCHARGE  
FROM dmat_archival.citrus_usr.CDSL_HOLDING_DTLS WITH (NOLOCK)  
WHERE   
CDSHM_TRAS_DT >= '01-OCT-2014' And CDSHM_TRAS_DT <= '31-Mar-2021'   
  
--CDSHM_TRAS_DT >= 'oct  1 2014' And CDSHM_TRAS_DT <= 'mar 31 2019'   
AND cdshm_tratm_cd IN ('2246', '2277', '2201', '3102', '2270', '2220', '2262', '2251', '2202', '2205')---and cdshm_ben_Acct_no='1203320016914621'  
 
 

union all  
  
SELECT CDSHM_TRAS_DT TD_CURDATE, cdshm_ben_Acct_no TD_AC_CODE, cdshm_isin TD_ISIN_CODE,   
  CASE   
  WHEN cdshm_qty < 0  
   THEN cdshm_qty * - 1  
  ELSE cdshm_qty  
  END TD_QTY, '' TD_CLEAR_CORPN, LEFT(CDSHM_COUNTER_DPID, 16) TD_COUNTERDP, LEFT(ISNULL(CDSHM_COUNTER_BOID, CDSHM_COUNTER_DPID), 16) TD_BENEFICIERY, CDSHM_TRANS_NO TD_REFERENCE, LEFT(REPLACE(cdshm_tratm_type_desc, 'FILE', ''), 100) TD_DESCRIPTION, NULL TD_CATEGORY, NULL TD_AC_TYPE, NULL TD_NARRATION, NULL TD_BOOKING_TYPE, CDSHM_SETT_TYPE TD_MARKET_TYPE, CDSHM_SETT_NO TD_SETTLEMENT, '0' TD_BLOCKED, '00' TD_BLOCKEDCD, NULL TD_RDATE, LEFT(CONVERT(VARCHAR, CDSHM_TRAS_DT, 112), 8) TD_TRXDATE, '' TD_TRXTIME,   
  CASE   
  WHEN CDSHM_QTY < 0  
   THEN 'D'  
  ELSE 'C'  
  END TD_DEBIT_CREDIT, cdshm_tratm_cd TD_TRXNO, '' TD_CHARGE_CODE, 0 TD_RATE, 0 TD_AMOUNT, '' TD_INTERNAL_REFNO, '' TD_COUNTERCMBPID, 0 TD_TOTCERT, '' TD_CHARGEFLAG, '' MKRID, '' MKRDT, '' TD_REJCODE, '' TD_BILLCODE, 0 TD_CDSLCHARGE, '' TD_PDCD, '' TD_PDCODE,   
CASE WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='68' THEN ' CA- TRF OF SHARES TO IEPF' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='69' THEN ' CA- TRF OF SHS – NSDL IEPF' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='70' THEN ' CA- TRF OF SHS TO IEPF PHY' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='71' THEN ' CA- TRF OF SHS TO IEPF ACA' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='72' THEN ' CA- SUSPENSE ACCOUNT DEBIT' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,27,'~') IN (1,3) AND CDSHM_CDAS_TRAS_TYPE = '18' THEN ' ACCOUNT TRANSFER' +'-'+   ISNULL(CDSHM_COUNTER_BOID,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,2,'~') ='7' AND CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,25,'~') ='R' THEN 'REMAT REJECT -' +  CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,38,'~')    
 ELSE REPLACE(LEFT(CDSHM_TRATM_DESC, 100),'        ','') END   TD_REMARKS, 0 TD_ACTUALCDSLCHARGE  
FROM dmat_archival.citrus_usr.CDSL_HOLDING_DTLS WITH (NOLOCK)  
WHERE   
CDSHM_TRAS_DT >= '01-OCT-2014' And CDSHM_TRAS_DT <= '31-Mar-2021'    And  
cdshm_tratm_cd IN ('2215')---and cdshm_ben_Acct_no='1203320016914621'  
and CDSHM_CDAS_TRAS_TYPE='4' and  CDSHM_CDAS_SUB_TRAS_TYPE ='409' 


union all  
  
SELECT CDSHM_TRAS_DT TD_CURDATE, cdshm_ben_Acct_no TD_AC_CODE, cdshm_isin TD_ISIN_CODE,   
  CASE   
  WHEN cdshm_qty < 0  
   THEN cdshm_qty * - 1  
  ELSE cdshm_qty  
  END TD_QTY, '' TD_CLEAR_CORPN, LEFT(CDSHM_COUNTER_DPID, 16) TD_COUNTERDP, LEFT(ISNULL(CDSHM_COUNTER_BOID, CDSHM_COUNTER_DPID), 16) TD_BENEFICIERY, CDSHM_TRANS_NO TD_REFERENCE, LEFT(REPLACE(cdshm_tratm_type_desc, 'FILE', ''), 100) TD_DESCRIPTION, NULL TD_CATEGORY, NULL TD_AC_TYPE, NULL TD_NARRATION, NULL TD_BOOKING_TYPE, CDSHM_SETT_TYPE TD_MARKET_TYPE, CDSHM_SETT_NO TD_SETTLEMENT, '0' TD_BLOCKED, '00' TD_BLOCKEDCD, NULL TD_RDATE, LEFT(CONVERT(VARCHAR, CDSHM_TRAS_DT, 112), 8) TD_TRXDATE, '' TD_TRXTIME,   
  CASE   
  WHEN CDSHM_QTY < 0  
   THEN 'D'  
  ELSE 'C'  
  END TD_DEBIT_CREDIT, cdshm_tratm_cd TD_TRXNO, '' TD_CHARGE_CODE, 0 TD_RATE, 0 TD_AMOUNT, '' TD_INTERNAL_REFNO, '' TD_COUNTERCMBPID, 0 TD_TOTCERT, '' TD_CHARGEFLAG, '' MKRID, '' MKRDT, '' TD_REJCODE, '' TD_BILLCODE, 0 TD_CDSLCHARGE, '' TD_PDCD, '' TD_PDCODE,   
CASE WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='68' THEN ' CA- TRF OF SHARES TO IEPF' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='69' THEN ' CA- TRF OF SHS – NSDL IEPF' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='70' THEN ' CA- TRF OF SHS TO IEPF PHY' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='71' THEN ' CA- TRF OF SHS TO IEPF ACA' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='72' THEN ' CA- SUSPENSE ACCOUNT DEBIT' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,27,'~') IN (1,3) AND CDSHM_CDAS_TRAS_TYPE = '18' THEN ' ACCOUNT TRANSFER' +'-'+   ISNULL(CDSHM_COUNTER_BOID,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,2,'~') ='7' AND CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,25,'~') ='R' THEN 'REMAT REJECT -' +  CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,38,'~')    
 ELSE REPLACE(LEFT(CDSHM_TRATM_DESC, 100),'        ','') END   TD_REMARKS, 0 TD_ACTUALCDSLCHARGE  
FROM Citrus_usr.CDSL_HOLDING_DTLS WITH (NOLOCK)  
WHERE   
CDSHM_TRAS_DT > '31-Mar-2021' And  
cdshm_tratm_cd IN ('2246', '2277', '2201', '3102', '2270', '2220', '2262', '2251', '2202', '2205')---and cdshm_ben_Acct_no='1203320016914621'  
  
  
union all  
  
SELECT CDSHM_TRAS_DT TD_CURDATE, cdshm_ben_Acct_no TD_AC_CODE, cdshm_isin TD_ISIN_CODE,   
  CASE   
  WHEN cdshm_qty < 0  
   THEN cdshm_qty * - 1  
  ELSE cdshm_qty  
  END TD_QTY, '' TD_CLEAR_CORPN, LEFT(CDSHM_COUNTER_DPID, 16) TD_COUNTERDP, LEFT(ISNULL(CDSHM_COUNTER_BOID, CDSHM_COUNTER_DPID), 16) TD_BENEFICIERY, CDSHM_TRANS_NO TD_REFERENCE, LEFT(REPLACE(cdshm_tratm_type_desc, 'FILE', ''), 100) TD_DESCRIPTION, NULL TD_CATEGORY, NULL TD_AC_TYPE, NULL TD_NARRATION, NULL TD_BOOKING_TYPE, CDSHM_SETT_TYPE TD_MARKET_TYPE, CDSHM_SETT_NO TD_SETTLEMENT, '0' TD_BLOCKED, '00' TD_BLOCKEDCD, NULL TD_RDATE, LEFT(CONVERT(VARCHAR, CDSHM_TRAS_DT, 112), 8) TD_TRXDATE, '' TD_TRXTIME,   
  CASE   
  WHEN CDSHM_QTY < 0  
   THEN 'D'  
  ELSE 'C'  
  END TD_DEBIT_CREDIT, cdshm_tratm_cd TD_TRXNO, '' TD_CHARGE_CODE, 0 TD_RATE, 0 TD_AMOUNT, '' TD_INTERNAL_REFNO, '' TD_COUNTERCMBPID, 0 TD_TOTCERT, '' TD_CHARGEFLAG, '' MKRID, '' MKRDT, '' TD_REJCODE, '' TD_BILLCODE, 0 TD_CDSLCHARGE, '' TD_PDCD, '' TD_PDCODE,   
CASE WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='68' THEN ' CA- TRF OF SHARES TO IEPF' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='69' THEN ' CA- TRF OF SHS – NSDL IEPF' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='70' THEN ' CA- TRF OF SHS TO IEPF PHY' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='71' THEN ' CA- TRF OF SHS TO IEPF ACA' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,36,'~') ='72' THEN ' CA- SUSPENSE ACCOUNT DEBIT' +'-'+ ISNULL(CDSHM_INT_REF_NO,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,27,'~') IN (1,3) AND CDSHM_CDAS_TRAS_TYPE = '18' THEN ' ACCOUNT TRANSFER' +'-'+   ISNULL(CDSHM_COUNTER_BOID,'')  
WHEN CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,2,'~') ='7' AND CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,25,'~') ='R' THEN 'REMAT REJECT -' +  CITRUS_USR.FN_SPLITVAL_BY(CDSHM_TRANS_CDAS_CODE,38,'~')    
 ELSE REPLACE(LEFT(CDSHM_TRATM_DESC, 100),'        ','') END   TD_REMARKS, 0 TD_ACTUALCDSLCHARGE  
FROM Citrus_usr.CDSL_HOLDING_DTLS WITH (NOLOCK)  
WHERE   
CDSHM_TRAS_DT > '31-Mar-2021' And  
cdshm_tratm_cd IN ('2215')---and cdshm_ben_Acct_no='1203320016914621'  
and CDSHM_CDAS_TRAS_TYPE='4' and  CDSHM_CDAS_SUB_TRAS_TYPE ='409' 



  
union all  
  
SELECT * FROM [172.31.16.30].synergy.DBO.[SYNERGY_TRXN_DETAILS] WHERE TD_CURDATE <='2015-03-31 23:59'

GO
