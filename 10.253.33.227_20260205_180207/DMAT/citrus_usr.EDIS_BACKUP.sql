-- Object: PROCEDURE citrus_usr.EDIS_BACKUP
-- Server: 10.253.33.227 | DB: DMAT
--------------------------------------------------

CREATE PROCEDURE [citrus_usr].[EDIS_BACKUP] ( @pa_slip_no varchar(25),@reasonforbackup varchar (100))
--EXEC EDIS_BACKUP '3112202060107866'
AS 


INSERT INTO DPTDC_MAK_BAK_DND
SELECT DPTDC_ID
,DPTDC_DPAM_ID
,DPTDC_REQUEST_DT
,DPTDC_SLIP_NO
,DPTDC_ISIN
,DPTDC_BATCH_NO
,DPTDC_LINE_NO
,DPTDC_QTY
,DPTDC_INTERNAL_REF_NO
,DPTDC_TRANS_NO
,DPTDC_MKT_TYPE
,DPTDC_SETTLEMENT_NO
,DPTDC_EXECUTION_DT
,DPTDC_OTHER_SETTLEMENT_TYPE
,DPTDC_OTHER_SETTLEMENT_NO
,DPTDC_COUNTER_DP_ID
,DPTDC_COUNTER_CMBP_ID
,DPTDC_COUNTER_DEMAT_ACCT_NO
,dptdC_trastm_cd
,DPTDC_DTLS_ID
,DPTDC_BOOKING_NARRATION
,DPTDC_BOOKING_TYPE
,DPTDC_CONVERTED_QTY
,DPTDC_REASON_CD
,DPTDC_STATUS
,DPTDC_INTERNAL_TRASTM
,DPTDC_EXCM_ID
,DPTDC_CASH_TRF
,DPTDC_CM_ID
,DPTDC_CREATED_BY
,DPTDC_CREATED_DT
,DPTDC_LST_UPD_BY
,DPTDC_LST_UPD_DT
,DPTDC_DELETED_IND
,dptdc_rmks
,DPTDC_ERRMSG
,DPTDC_BROKERBATCH_NO
,DPTDC_BROKER_INTERNAL_REF_NO
,dptdc_mid_chk
,dptdc_res_cd
,dptdc_res_desc
,DPTDC_PAYMODE
,DPTDC_BANKACNO
,DPTDC_BANKACNAME
,DPTDC_BANKBRNAME
,DPTDC_TRANSFEREENAME
,DPTDC_DOI
,DPTDC_CHQ_REFNO
,@reasonforbackup
,GETDATE ()
,DPTDc_UCC
,DPTDc_EXID
,DPTDc_SEGID
,DPTDc_CMID
,DPTDc_EID
,DPTDc_TMCMID FROM DPTDC_MAK  WHERE DPTDC_SLIP_NO in (select DPTDC_TRANS_NO from edis_pre_DPTDC_MAK where DPTDC_slip_NO= @pa_slip_no)


INSERT INTO dp_trx_dtls_cdsl_BAK_DND
SELECT DPTDC_ID
,DPTDC_DPAM_ID
,DPTDC_REQUEST_DT
,DPTDC_SLIP_NO
,DPTDC_ISIN
,DPTDC_BATCH_NO
,DPTDC_LINE_NO
,DPTDC_QTY
,DPTDC_INTERNAL_REF_NO
,DPTDC_TRANS_NO
,DPTDC_MKT_TYPE
,DPTDC_SETTLEMENT_NO
,DPTDC_EXECUTION_DT
,DPTDC_OTHER_SETTLEMENT_TYPE
,DPTDC_OTHER_SETTLEMENT_NO
,DPTDC_COUNTER_DP_ID
,DPTDC_COUNTER_CMBP_ID
,DPTDC_COUNTER_DEMAT_ACCT_NO
,dptdC_trastm_cd
,DPTDC_DTLS_ID
,DPTDC_BOOKING_NARRATION
,DPTDC_BOOKING_TYPE
,DPTDC_CONVERTED_QTY
,DPTDC_REASON_CD
,DPTDC_STATUS
,DPTDC_INTERNAL_TRASTM
,DPTDC_EXCM_ID
,DPTDC_CASH_TRF
,DPTDC_CM_ID
,DPTDC_CREATED_BY
,DPTDC_CREATED_DT
,DPTDC_LST_UPD_BY
,DPTDC_LST_UPD_DT
,DPTDC_DELETED_IND
,DPTDC_RMKS
,DPTDC_ERRMSG
,DPTDC_BROKERBATCH_NO
,DPTDC_BROKER_INTERNAL_REF_NO
,dptdc_others_cl_name
,DPTDC_PAYMODE
,DPTDC_BANKACNO
,DPTDC_BANKACNAME
,DPTDC_BANKBRNAME
,DPTDC_TRANSFEREENAME
,DPTDC_DOI
,DPTDC_CHQ_REFNO
,@reasonforbackup
,GETDATE ()
,DPTDc_UCC
,DPTDc_EXID
,DPTDc_SEGID
,DPTDc_CMID
,DPTDc_EID
,DPTDc_TMCMID FROM dp_trx_dtls_cdsl WHERE DPTDC_SLIP_NO in (select DPTDC_TRANS_NO from edis_pre_DPTDC_MAK where DPTDC_slip_NO= @pa_slip_no)

INSERT INTO USED_SLIP_BAK_DND
SELECT USES_ID
,USES_DPM_ID
,USES_DPAM_ACCT_NO
,USES_SLIP_NO
,USES_TRANTM_ID
,USES_SERIES_TYPE
,USES_USED_DESTR
,USES_CREATED_BY
,USES_CREATED_DT
,USES_LST_UPD_BY
,USES_LST_UPD_DT
,USES_DELETED_IND 
,uses_slipremarks
, @reasonforbackup, GETDATE () FROM USED_SLIP  WHERE USES_SLIP_NO  in (select DPTDC_TRANS_NO from edis_pre_DPTDC_MAK where DPTDC_slip_NO= @pa_slip_no)

GO
