-- Object: VIEW citrus_usr.Vw_dp_daily_hldg_cdsl
-- Server: 10.253.33.227 | DB: DMAT
--------------------------------------------------

CREATE view [citrus_usr].[Vw_dp_daily_hldg_cdsl]
AS

		/*SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='CURRENT',QTY=DPHMCD_CURR_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_CURR_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='FREE',QTY=DPHMCD_FREE_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_FREE_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='FREEZE',QTY=DPHMCD_FREEZE_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_FREEZE_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='PLEDGE',QTY=DPHMCD_PLEDGE_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_PLEDGE_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='DEMAT PENDING VERIFICATION',QTY=DPHMCD_DEMAT_PND_VER_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_DEMAT_PND_VER_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='REMAT PENDING CONFIRMATION',QTY=DPHMCD_REMAT_PND_CONF_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_REMAT_PND_CONF_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='DEMAT PENDING CONFIRMATION',QTY=DPHMCD_DEMAT_PND_CONF_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_DEMAT_PND_CONF_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='SAFE KEEPING',QTY=DPHMCD_SAFE_KEEPING_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_SAFE_KEEPING_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='LOCKIN',QTY=DPHMCD_LOCKIN_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_LOCKIN_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='ELIMINATION',QTY=DPHMCD_ELIMINATION_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_ELIMINATION_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='EARMARK',QTY=DPHMCD_EARMARK_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_EARMARK_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='AVAILABLE FOR LEND',QTY=DPHMCD_AVAIL_LEND_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_AVAIL_LEND_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='LEND',QTY=DPHMCD_LEND_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_LEND_QTY,0) <> 0
		UNION ALL
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE='BORROW',QTY=DPHMCD_BORROW_QTY FROM dp_daily_hldg_cdsl WHERE ISNULL(DPHMCD_BORROW_QTY,0) <> 0
		*/
		
		--sp_dbcmptlevel ccpl_dp , 90
		
		SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN,BAL_TYPE,QTY
		FROM 
		   (SELECT DPHMCD_DPM_ID,DPHMCD_HOLDING_DT,DPHMCD_DPAM_ID,DPHMCD_ISIN
		         , dphmcd_curr_qty [CURRENT]
		         , dphmcd_free_qty [FREE]
		         , dphmcd_freeze_qty [FREEZE]
											, dphmcd_pledge_qty [PLEDGE]
											, dphmcd_demat_pnd_ver_qty [DEMAT PENDING VERIFICATION]
											, dphmcd_remat_pnd_conf_qty [REMAT PENDING CONFIRMATION]
											, dphmcd_demat_pnd_conf_qty [DEMAT PENDING CONFIRMATION]
											, dphmcd_safe_keeping_qty [SAFE KEEPING]
											, dphmcd_lockin_qty [LOCKIN]
											, dphmcd_elimination_qty [ELIMINATION]
											, dphmcd_earmark_qty [EARMARK]
											, dphmcd_avail_lend_qty [AVAILABLE FOR LEND]
											, dphmcd_lend_qty [LEND]
           , dphmcd_borrow_qty [BORROW]
		   FROM dp_daily_hldg_cdsl) p
		UNPIVOT
		   (Qty FOR BAL_TYPE IN 
		      ([CURRENT]
		      ,[FREE]
		      ,[FREEZE]
		      ,[PLEDGE]
		      ,[DEMAT PENDING VERIFICATION]
		      ,[REMAT PENDING CONFIRMATION]
		      ,[DEMAT PENDING CONFIRMATION]
		      ,[SAFE KEEPING]
		      ,[LOCKIN]
		      ,[ELIMINATION]
		      ,[EARMARK]
		      ,[AVAILABLE FOR LEND]
		      ,[LEND]
		      ,[BORROW])
  )AS unpvt

GO
