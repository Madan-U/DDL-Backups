-- Object: PROCEDURE citrus_usr.PR_CAT_SUB_CAT_DATA
-- Server: 10.253.33.227 | DB: DMAT
--------------------------------------------------

-- exec PR_CAT_SUB_CAT_DATA

create   PROC [citrus_usr].[PR_CAT_SUB_CAT_DATA]
AS 
TRUNCATE TABLE CAT_SUBCAT_DATA
INSERT INTO CAT_SUBCAT_DATA
SELECT   CLICM_DESC [TYPE] , CASE WHEN ENTTM_CD IS NULL  
AND SUBCM_DESC  = 'CLIENT UNPAID SECURITIES ACCOUNT' THEN 'CLEARING MEMBER A/C' ELSE ENTTM_DESC END CATEGORY ,   SUBCM_DESC [SUB TYPE],
DPAM_SBA_NO CSBA 

FROM DP_ACCT_MSTR   LEFT OUTER JOIN 
SUB_CTGRY_MSTR ON DPAM_SUBCM_CD = SUBCM_CD AND SUBCM_DELETED_IND = '1'
LEFT OUTER JOIN CLIENT_CTGRY_MSTR ON DPAM_CLICM_CD  = CLICM_CD AND CLICM_DELETED_IND = '1' 
LEFT OUTER JOIN ENTITY_TYPE_MSTR  ON DPAM_ENTTM_CD = ENTTM_CD  AND ENTTM_DELETED_IND = '1'
WHERE  DPAM_DELETED_IND = '1' AND DPAM_ACCT_NO <> DPAM_SBA_NO AND DPAM_SBA_NO NOT LIKE '220%'

GO
