-- Object: PROCEDURE citrus_usr.PR_INS_UPD_OTP_bak_30092016
-- Server: 10.253.33.227 | DB: DMAT
--------------------------------------------------




Create PROCEDURE [citrus_usr].[PR_INS_UPD_OTP] 
(

@PA_ACTION Varchar(10),
@PA_BOID VARCHAR(20),
@PA_OTP_TYPE VARCHAR(20),
@PA_OTP_MOBILE VARCHAR(20),
@PA_OTPNO VARCHAR(20),
@PA_CMBPID VARCHAR(20),
@PA_TDPID VARCHAR(20),
@PA_LOGINNAMES VARCHAR(20)

)
As
BEGIN

--IF @PA_ACTION ='SELECT_CONT'

--    SELECT distinct CONC_VALUE FROM DP_ACCT_MSTR AM,CONTACT_CHANNELS 
--    CC,ENTITY_ADR_CONC EC,ENTITY_PROPERTIES EP              
--    WHERE CC.CONC_ID = EC.ENTAC_ADR_CONC_ID
--    AND AM.DPAM_CRN_NO = EC.ENTAC_ENT_ID 
--    AND AM.DPAM_SBA_NO = @PA_BOID
--    AND  ENTAC_CONCM_CD='MOBILE1'

IF @PA_ACTION ='INS_UPD'

   IF NOT EXISTS(SELECT OTP_NO FROM OTP_MSTR WHERE  OTP_BOID=@PA_BOID  AND OTP_TYPE ='C' AND OTP_DELETED_IND=1)
      INSERT INTO OTP_MSTR
      SELECT @PA_OTP_TYPE,@PA_OTP_MOBILE,@PA_BOID,@PA_TDPID,@PA_OTPNO,'0',@PA_LOGINNAMES,GETDATE(),@PA_LOGINNAMES,GETDATE(),1,''

ELSE
      UPDATE OTP_MSTR SET OTP_NO = @PA_OTPNO  WHERE  OTP_BOID=@PA_BOID AND OTP_MOBILE = @PA_OTP_MOBILE AND OTP_TYPE ='C' AND  OTP_DELETED_IND=1

ELSE IF @PA_ACTION ='SELECT_OTP'

     SELECT OTP_NO FROM OTP_MSTR WHERE  OTP_BOID=@PA_BOID AND OTP_MOBILE = @PA_OTP_MOBILE AND OTP_TYPE ='C' AND OTP_DELETED_IND=1
END

GO
