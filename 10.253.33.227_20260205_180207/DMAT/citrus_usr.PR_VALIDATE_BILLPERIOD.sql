-- Object: PROCEDURE citrus_usr.PR_VALIDATE_BILLPERIOD
-- Server: 10.253.33.227 | DB: DMAT
--------------------------------------------------

---PR_VALIDATE_BILLPERIOD 'Jul 27 2009','Jul 27 2009','IN300175','O',''

CREATE PROCEDURE [citrus_usr].[PR_VALIDATE_BILLPERIOD]
(
@PA_FROMDT DATETIME,
@PA_TODT DATETIME,
@PA_DP_ID VARCHAR(8),
@PA_B2B_OUTSTANDING_FLG varchar(1),
@PA_OUTREF varchar(8000) out
)
AS
BEGIN
DECLARE @@L_DPMID BIGINT

SELECT @@L_DPMID = DPM_ID FROM DP_MSTR WHERE DPM_DPID =  @PA_DP_ID
IF (@PA_B2B_OUTSTANDING_FLG='B')
BEGIN
SELECT @PA_OUTREF =  CASE WHEN EXISTS(SELECT BILLC_DPM_ID FROM BILL_CYCLE WHERE BILLC_DPM_ID = @@L_DPMID AND BILLC_FROM_DT LIKE CONVERT(VARCHAR(11),@PA_FROMDT,109) + '%' AND BILLC_TO_DT LIKE CONVERT(VARCHAR(11),@PA_TODT,109) + '%') THEN 'Y' ELSE 'Y' END 
END
ELSE
BEGIN 
SELECT @PA_OUTREF =  CASE WHEN EXISTS(SELECT BILLC_DPM_ID FROM BILL_CYCLE WHERE BILLC_DPM_ID = @@L_DPMID AND CONVERT(VARCHAR(11),@PA_TODT,109) BETWEEN  BILLC_FROM_DT  AND BILLC_TO_DT) THEN 'Y' ELSE 'Y' END 
END
PRINT @PA_OUTREF
END

GO
