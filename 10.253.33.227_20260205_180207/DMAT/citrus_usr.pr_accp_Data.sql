-- Object: PROCEDURE citrus_usr.pr_accp_Data
-- Server: 10.253.33.227 | DB: DMAT
--------------------------------------------------



--SELECT DISTINCT ACCPM_PROP_CD , ACCPM_PROP_dESC  FROM ACCOUNT_PROPERTY_MSTR 
--drop table #temp
--EXEC PR_ACCP_DATA
CREATE   PROC [citrus_usr].[pr_accp_Data]
AS 
begin
TRUNCATE TABLE ACCP_DATA
insert into ACCP_DATA
select DPAM_SBA_NO , 
replace (ISNULL(ACCLOSE.ACCP_VALUE,'') ,'//','')[ACCLOSEDT] 
, ISNULL(ADHAARFLAG.ACCP_VALUE,'') [1ST HOLDER AADHAAR]  
, ISNULL(ADHAARSECHLDR.ACCP_VALUE,'') [2ND HOLDER AADHAAR]  
, ISNULL(ADHAARTHRDHLDR.ACCP_VALUE,'') [3RD HOLDER AADHAAR]  
, replace (ISNULL(ACOPNDT.ACCP_VALUE,'') ,'//','')[A/C ACTIVATION DATE]
, case when ISNULL(BSDA.ACCP_VALUE,'') = '1' then 'YES'when ISNULL(BSDA.ACCP_VALUE,'') = '0' then 'NO' else  ISNULL(BSDA.ACCP_VALUE,'') end [BSDA FLAG]
, ISNULL(CAS_FLAG.ACCP_VALUE,'') [CAS FLAG]
, ISNULL(CP.ACCP_VALUE,'') [COMMUNICATION PREFERENCE]
, ISNULL(EMAIL_ST_FLAG.ACCP_VALUE,'') [EMAIL STATEMENT FLAG]
, ISNULL(MOO.ACCP_VALUE,'') [MODE OF OPERATION]
, ISNULL(PANVC.ACCP_VALUE,'') [PAN FLAG-1ST HLDR]
, ISNULL(PANVC2.ACCP_VALUE,'') [PAN FLAG-2ND HLDR]
, ISNULL(PANVC3.ACCP_VALUE,'') [PAN FLAG-3RD HLDR]
, ISNULL(SMART_REG.ACCP_VALUE,'') [SMART REGISTRATION]
, ISNULL(NETWORTH_DT.ACCP_VALUE,'') [NETWORTH DATE]
, ISNULL(NETWRTH.ACCP_VALUE,'') [NETWORTH]
--into ACCP_DATA
from dp_accT_MSTR 
LEFT OUTER JOIN ACCOUNT_PROPERTIES ACCLOSE ON ACCLOSE.ACCP_CLISBA_ID = DPAM_ID  AND  ACCLOSE.ACCP_ACCPM_PROP_CD ='ACC_CLOSE_DT' --and ACCLOSE.ACCP_VALUE not in('//')
LEFT OUTER JOIN ACCOUNT_PROPERTIES ADHAARFLAG ON ADHAARFLAG.ACCP_CLISBA_ID = DPAM_ID  AND  ADHAARFLAG.ACCP_ACCPM_PROP_CD ='ADHAARFLAG' --and ACCLOSE.ACCP_VALUE not in('//')
LEFT OUTER JOIN ACCOUNT_PROPERTIES ADHAARSECHLDR ON ADHAARSECHLDR.ACCP_CLISBA_ID = DPAM_ID  AND  ADHAARSECHLDR.ACCP_ACCPM_PROP_CD ='ADHAARSECHLDR' --and ACCLOSE.ACCP_VALUE not in('//')
LEFT OUTER JOIN ACCOUNT_PROPERTIES ADHAARTHRDHLDR ON ADHAARTHRDHLDR.ACCP_CLISBA_ID = DPAM_ID  AND  ADHAARTHRDHLDR.ACCP_ACCPM_PROP_CD ='ADHAARTHRDHLDR' --and ACCLOSE.ACCP_VALUE not in('//')
LEFT OUTER JOIN ACCOUNT_PROPERTIES ACOPNDT ON ACOPNDT.ACCP_CLISBA_ID = DPAM_ID  AND  ACOPNDT.ACCP_ACCPM_PROP_CD ='BILL_START_DT' --and ACCLOSE.ACCP_VALUE not in('//')
LEFT OUTER JOIN ACCOUNT_PROPERTIES BSDA ON BSDA.ACCP_CLISBA_ID = DPAM_ID  AND  BSDA.ACCP_ACCPM_PROP_CD ='BSDA'
LEFT OUTER JOIN ACCOUNT_PROPERTIES CAS_FLAG ON CAS_FLAG.ACCP_CLISBA_ID = DPAM_ID  AND  CAS_FLAG.ACCP_ACCPM_PROP_CD ='CAS_FLAG'
LEFT OUTER JOIN ACCOUNT_PROPERTIES CP ON CP.ACCP_CLISBA_ID = DPAM_ID  AND  CP.ACCP_ACCPM_PROP_CD ='CP'
LEFT OUTER JOIN ACCOUNT_PROPERTIES EMAIL_ST_FLAG ON EMAIL_ST_FLAG.ACCP_CLISBA_ID = DPAM_ID  AND  EMAIL_ST_FLAG.ACCP_ACCPM_PROP_CD ='EMAIL_ST_FLAG'
LEFT OUTER JOIN ACCOUNT_PROPERTIES MOO ON MOO.ACCP_CLISBA_ID = DPAM_ID  AND  MOO.ACCP_ACCPM_PROP_CD ='MOO'
LEFT OUTER JOIN ACCOUNT_PROPERTIES PANVC ON PANVC.ACCP_CLISBA_ID = DPAM_ID  AND  PANVC.ACCP_ACCPM_PROP_CD ='PANVC'
LEFT OUTER JOIN ACCOUNT_PROPERTIES PANVC2 ON PANVC2.ACCP_CLISBA_ID = DPAM_ID  AND  PANVC2.ACCP_ACCPM_PROP_CD ='PANVC2'
LEFT OUTER JOIN ACCOUNT_PROPERTIES PANVC3 ON PANVC3.ACCP_CLISBA_ID = DPAM_ID  AND  PANVC3.ACCP_ACCPM_PROP_CD ='PANVC3'
LEFT OUTER JOIN ACCOUNT_PROPERTIES SMART_REG ON SMART_REG.ACCP_CLISBA_ID = DPAM_ID  AND  SMART_REG.ACCP_ACCPM_PROP_CD ='SMART_REG'
LEFT OUTER JOIN ACCOUNT_PROPERTIES NETWORTH_DT ON NETWORTH_DT.ACCP_CLISBA_ID = DPAM_ID  AND  NETWORTH_DT.ACCP_ACCPM_PROP_CD ='NETWORTH_DT'
LEFT OUTER JOIN ACCOUNT_PROPERTIES NETWRTH ON NETWRTH.ACCP_CLISBA_ID = DPAM_ID  AND  NETWRTH.ACCP_ACCPM_PROP_CD ='NETWRTH'
WHERE DPAM_ACCT_NO <> DPAM_SBA_NO 
AND DPAM_DELETED_IND = 1 
--and DPAM_SBA_NO = '1203320200499967'
AND DPAM_SBA_NO LIKE '120%'

--select * from #temp 

end

GO
