-- Object: VIEW citrus_usr.Dp_client_master_Class_BAK_02062021
-- Server: 10.253.78.187 | DB: DMAT
--------------------------------------------------



CREATE VIEW [citrus_usr].[Dp_client_master_Class_BAK_02062021]  

AS

SELECT   DPS8_PC1.BOID BOID
--, REPLACE(REPLACE(ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'BA'),ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'BR'),'')),'_BA',''),'_BR','')   CM_BRBOFFCODE  
, ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'RE'),'')  [REGION]
, ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'AR'),'')  [AREA]
, ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'BA'),ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'BR'),''))  [BRANCH/BA CODE]  
, ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'ONW'),ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'REM'),''))  [REMISSOR/ONWARD]

, ISNULL(BROM_DESC,'') DPTARIFFID  
,ISNULL(PANGIR,'') PANGIR
FROM  DPS8_PC1 WITH (NOLOCK) LEFT OUTER JOIN 
DP_ACCT_MSTR DPAM  WITH (NOLOCK) ON DPS8_PC1.BOID = DPAM_SBA_NO 
LEFT OUTER JOIN 
CLIENT_DP_BRKG  WITH (NOLOCK)    ON DPAM_ID = CLIDB_DPAM_ID 
AND GETDATE() BETWEEN CLIDB_EFF_FROM_DT AND ISNULL(CLIDB_EFF_TO_DT  ,'DEC 31 2100') AND CLIDB_DELETED_IND = 1 
LEFT OUTER JOIN   
BROKERAGE_MSTR WITH (NOLOCK)  ON BROM_ID = CLIDB_BROM_ID    
WHERE   ISNUMERIC(DPAM.DPAM_SBA_NO)=1

GO
