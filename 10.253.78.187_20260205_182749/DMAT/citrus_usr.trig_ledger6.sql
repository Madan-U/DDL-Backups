-- Object: TRIGGER citrus_usr.trig_ledger6
-- Server: 10.253.78.187 | DB: DMAT
--------------------------------------------------

CREATE TRIGGER [citrus_usr].[trig_ledger6]   
 ON [citrus_usr].[LEDGER6]  
 FOR INSERT,UPDATE  
 AS  
 DECLARE @l_action VARCHAR(20)  
 SET @l_action = 'E'  
 IF UPDATE(LDG_DELETED_IND)  
 BEGIN  
   IF EXISTS(SELECT inserted.LDG_ID FROM inserted WHERE  inserted.LDG_DELETED_IND  = 0)  
   BEGIN  
     SET @l_action = 'D'  
   END    
   
 END  
 IF NOT EXISTS(SELECT deleted.LDG_ID FROM deleted)   
 BEGIN  
   INSERT INTO LEDGER_HST6(LDG_ID,LDG_DPM_ID,LDG_VOUCHER_TYPE,LDG_BOOK_TYPE_CD,LDG_VOUCHER_NO,LDG_SR_NO,LDG_REF_NO,LDG_VOUCHER_DT,LDG_ACCOUNT_ID,LDG_ACCOUNT_TYPE,LDG_AMOUNT,LDG_NARRATION,LDG_BANK_ID,LDG_ACCOUNT_NO,LDG_INSTRUMENT_NO,LDG_BANK_CL_DATE,LDG_COST_CD_ID,LDG_BILL_BRKUP_ID,LDG_TRANS_TYPE,LDG_STATUS,LDG_CREATED_BY,LDG_CREATED_DT,LDG_LST_UPD_BY,LDG_LST_UPD_DT,LDG_DELETED_IND,LDG_BRANCH_ID,LDG_ACTION)     SELECT  inserted.LDG_ID,inserted.LDG_DPM_ID,inserted.LDG_VOUCHER_TYPE,inserted.LDG_BOOK_TYPE_CD,inserted.LDG_VOUCHER_NO,inserted.LDG_SR_NO,inserted.LDG_REF_NO,inserted.LDG_VOUCHER_DT,inserted.LDG_ACCOUNT_ID,inserted.LDG_ACCOUNT_TYPE,inserted.LDG_AMOUNT,inserted.LDG_NARRATION,inserted.LDG_BANK_ID,inserted.LDG_ACCOUNT_NO,inserted.LDG_INSTRUMENT_NO,inserted.LDG_BANK_CL_DATE,inserted.LDG_COST_CD_ID,inserted.LDG_BILL_BRKUP_ID,inserted.LDG_TRANS_TYPE,inserted.LDG_STATUS,inserted.LDG_CREATED_BY,inserted.LDG_CREATED_DT,inserted.LDG_LST_UPD_BY,inserted.LDG_LST_UPD_DT,inserted.LDG_DELETED_IND,inserted.LDG_BRANCH_ID,'I'     FROM   inserted  
 END  
 ELSE   
 BEGIN  
   INSERT INTO LEDGER_HST6(LDG_ID,LDG_DPM_ID,LDG_VOUCHER_TYPE,LDG_BOOK_TYPE_CD,LDG_VOUCHER_NO,LDG_SR_NO,LDG_REF_NO,LDG_VOUCHER_DT,LDG_ACCOUNT_ID,LDG_ACCOUNT_TYPE,LDG_AMOUNT,LDG_NARRATION,LDG_BANK_ID,LDG_ACCOUNT_NO,LDG_INSTRUMENT_NO,LDG_BANK_CL_DATE,LDG_COST_CD_ID,LDG_BILL_BRKUP_ID,LDG_TRANS_TYPE,LDG_STATUS,LDG_CREATED_BY,LDG_CREATED_DT,LDG_LST_UPD_BY,LDG_LST_UPD_DT,LDG_DELETED_IND,LDG_BRANCH_ID,LDG_ACTION)     SELECT inserted.LDG_ID,inserted.LDG_DPM_ID,inserted.LDG_VOUCHER_TYPE,inserted.LDG_BOOK_TYPE_CD,inserted.LDG_VOUCHER_NO,inserted.LDG_SR_NO,inserted.LDG_REF_NO,inserted.LDG_VOUCHER_DT,inserted.LDG_ACCOUNT_ID,inserted.LDG_ACCOUNT_TYPE,inserted.LDG_AMOUNT,inserted.LDG_NARRATION,inserted.LDG_BANK_ID,inserted.LDG_ACCOUNT_NO,inserted.LDG_INSTRUMENT_NO,inserted.LDG_BANK_CL_DATE,inserted.LDG_COST_CD_ID,inserted.LDG_BILL_BRKUP_ID,inserted.LDG_TRANS_TYPE,inserted.LDG_STATUS,inserted.LDG_CREATED_BY,inserted.LDG_CREATED_DT,inserted.LDG_LST_UPD_BY,inserted.LDG_LST_UPD_DT,inserted.LDG_DELETED_IND,inserted.LDG_BRANCH_ID,'E'  
   FROM   inserted  
   
   --IF @l_action = 'D'  
   --BEGIN  
   --    DELETE LEDGER6   
   --    FROM   LEDGER6 LDG  
   --         , inserted                    inserted  
   --    WHERE  LDG.LDG_ID               = inserted.LDG_ID  
   --    AND    inserted.LDG_DELETED_IND = 0  
   --END  
 END

GO
