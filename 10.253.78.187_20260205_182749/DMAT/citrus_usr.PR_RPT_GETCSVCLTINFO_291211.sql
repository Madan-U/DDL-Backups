-- Object: PROCEDURE citrus_usr.PR_RPT_GETCSVCLTINFO_291211
-- Server: 10.253.78.187 | DB: DMAT
--------------------------------------------------

CREATE PROCEDURE [citrus_usr].[PR_RPT_GETCSVCLTINFO_291211]
(
@PA_FROMACCNO VARCHAR(16)
,@PA_TOACCNO VARCHAR(16) 
,@PA_FROMDATE DATETIME
,@PA_TODATE DATETIME
)
AS
BEGIN 

IF @PA_FROMACCNO=''
BEGIN
SET  @PA_FROMACCNO='0'
SET @PA_TOACCNO ='9999999999999999'
END 

IF @PA_TOACCNO=''
BEGIN

SET @PA_TOACCNO =@PA_FROMACCNO
END 

SELECT DISTINCT CONVERT(DATETIME,ACCP_VALUE,103) ACCP_VALUE, ACCP_CLISBA_ID , ACCP_ACCPM_PROP_CD 
INTO #ACCOUNT_PROPERTIES FROM ACCOUNT_PROPERTIES WHERE ACCP_ACCPM_PROP_CD = 'BILL_START_DT' 
and ltrim(rtrim(accp_value)) not in ('/ /', '/ /','','//')  
and left(accp_value,2)<>'00'
and isdate(accp_value) = 1

SELECT DISTINCT D.DPAM_SBA_NO,REPLACE(ISNULL(D.DPAM_SBA_NAME,''),',','') DPAM_SBA_NAME,
ISNULL(CITRUS_USR.FN_CONC_VALUE(D.DPAM_CRN_NO,'MOBILE1'),'') [MOBILE],
ISNULL([CITRUS_USR].[FN_UCC_ENTP](D.DPAM_CRN_NO,'PAN_GIR_NO',''),'') PANNO
,CONVERT(VARCHAR(11),ACCP_VALUE,103) ACCP_VALUE--ISNULL([CITRUS_USR].[FN_ACCT_ENTP](DPAM_ID,'BILL_START_DT'),'')
,ISNULL(CLIBA_AC_NO,'') BANKACCNO
FROM DP_ACCT_MSTR D LEFT OUTER JOIN CLIENT_BANK_ACCTS ON  DPAM_ID=CLIBA_CLISBA_ID  AND CLIBA_DELETED_IND=1,#ACCOUNT_PROPERTIES D1
WHERE --ISDATE(ISNULL([CITRUS_USR].[FN_ACCT_ENTP](DPAM_ID,'BILL_START_DT'),''))=1 AND
 D.DPAM_ID=D1.ACCP_CLISBA_ID 
 AND LEN(D.DPAM_SBA_NO)=16 AND D.DPAM_STAM_CD='ACTIVE' 
AND D.DPAM_SBA_NO>= @PA_FROMACCNO 
AND D.DPAM_SBA_NO<= @PA_TOACCNO
AND ACCP_VALUE>=@PA_FROMDATE AND ACCP_VALUE<=@PA_TODATE
AND ISNULL(CITRUS_USR.FN_CONC_VALUE(D.DPAM_CRN_NO,'MOBILE1'),'') <>''
AND DPAM_DELETED_IND=1
ORDER BY D.DPAM_SBA_NO
END

GO
