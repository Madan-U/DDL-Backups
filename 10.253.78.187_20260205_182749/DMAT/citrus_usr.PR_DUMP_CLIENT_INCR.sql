-- Object: PROCEDURE citrus_usr.PR_DUMP_CLIENT_INCR
-- Server: 10.253.78.187 | DB: DMAT
--------------------------------------------------


----PROCEDURE CREATE UNDER SRE-423850-DATE- 04122025
CREATE PROC [citrus_usr].[PR_DUMP_CLIENT_INCR]    
AS        

    SELECT ACCTCREATDT,ACCTCREATDATE=RIGHT(ACCTCREATDT,4)+'-'+LEFT(RIGHT(ACCTCREATDT,6),2)+'-'+LEFT(ACCTCREATDT,2) INTO #DATE FROM (
    SELECT DISTINCT ACCTCREATDT
    FROM DPS8_PC1)A   WHERE 
    RIGHT(ACCTCREATDT,4)+'-'+LEFT(RIGHT(ACCTCREATDT,6),2)+'-'+LEFT(ACCTCREATDT,2) >=GETDATE()-3

   
 	SELECT BOID INTO #DUMP FROM DPS8_PC1 WHERE ACCTCREATDT IN (SELECT ACCTCREATDT FROM #DATE)
	CREATE INDEX #D ON #DUMP(BOID)

	DELETE S  FROM #DUMP S WHERE EXISTS( SELECT * FROM SYNERGY_CLIENT_MASTER  T WHERE T.CM_CD=S.BOID)

    SELECT *  INTO #SYNERGY_CLIENT_MASTER FROM SYNERGY_CLIENT_MASTER WITH(NOLOCK) WHERE 1=2    

	    
	INSERT INTO #SYNERGY_CLIENT_MASTER        
	SELECT * FROM  SYNERGY_CLIENT_MASTER_FORDUMP     WHERE EXISTS (SELECT * FROM #DUMP WHERE CM_CD=BOID)   
	   
    DELETE S  FROM #SYNERGY_CLIENT_MASTER S WHERE EXISTS( SELECT * FROM SYNERGY_CLIENT_MASTER  T WHERE T.CM_CD=S.CM_CD)

	INSERT INTO SYNERGY_CLIENT_MASTER        
	SELECT * FROM  #SYNERGY_CLIENT_MASTER  


	SELECT BOID INTO #TDUMP FROM DPS8_PC1 WHERE ACCTCREATDT IN (SELECT ACCTCREATDT FROM #DATE)
	CREATE INDEX #D ON #TDUMP(BOID)

	DELETE S  FROM #TDUMP S WHERE EXISTS( SELECT * FROM TBL_CLIENT_MASTER  T WHERE T.CLIENT_CODE=S.BOID)
	CREATE INDEX #DS ON #TDUMP(BOID)
 
    SELECT *  INTO #TBL_CLIENT_MASTER FROM TBL_CLIENT_MASTER WITH(NOLOCK) WHERE 1=2   
    
	INSERT INTO  #TBL_CLIENT_MASTER        
	SELECT  * FROM  TBL_CLIENT_MASTER_FORDUMP   WHERE EXISTS (SELECT * FROM #TDUMP WHERE CLIENT_CODE=BOID)     
 
    DELETE S  FROM #TBL_CLIENT_MASTER S WHERE EXISTS( SELECT * FROM TBL_CLIENT_MASTER  T WHERE T.CLIENT_CODE=S.CLIENT_CODE)
	
	INSERT INTO TBL_CLIENT_MASTER
	SELECT * FROM #TBL_CLIENT_MASTER

GO
