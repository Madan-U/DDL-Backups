-- Object: VIEW citrus_usr.MF_VIEW
-- Server: 10.253.78.167 | DB: DMAT
--------------------------------------------------


CREATE VIEW [citrus_usr].[MF_VIEW]
AS

SELECT  NISE_PARTY_CODE AS CLIENT_CODE,FIRST_HOLD_NAME AS ClientName,
FIRST_HOLD_ADD1 AS ADDRESS1,FIRST_HOLD_ADD2 AS ADDRESS2,FIRST_HOLD_ADD3 AS ADDRESS3,FIRST_HOLD_ADD4 AS CITY,
CONVERT(VARCHAR(15),'NA') AS OtherCity,FIRST_HOLD_STATE State,CONVERT(VARCHAR(15),'') OtherState,FIRST_HOLD_CNTRY AS Country,
CONVERT(VARCHAR(15),'NA') AS OtherCountry,FIRST_HOLD_PIN PinCode,EMAIL_ADD AS EMAILID,
'NA'OfficePhoneNo,'NA'	OfficeExtensionNo,'NA'	OfficeFaxNo,FIRST_HOLD_PHONE	HomePhonoNo,'NA'HomeFaxNo, FIRST_HOLD_MOBILE MobileNo,--T.Description Occupation,
(CASE WHEN PROFESSION_CODE ='H' THEN 6
     WHEN PROFESSION_CODE ='O' THEN '-1'
	 WHEN PROFESSION_CODE ='P' THEN 3
	 WHEN PROFESSION_CODE ='R' THEN 5
	 WHEN PROFESSION_CODE ='S' THEN 2
	 WHEN PROFESSION_CODE ='ST' THEN 7
	 WHEN PROFESSION_CODE ='F' THEN 48
	 WHEN PROFESSION_CODE ='B' THEN 1
	 WHEN PROFESSION_CODE ='GS' THEN 53
	 WHEN PROFESSION_CODE ='PV' THEN 35
	 WHEN PROFESSION_CODE ='PS' THEN 34
	 ELSE 6 END)  AS Occupation,
I.Description AnnualIncome,DIVIDEND_ACCOUNT_NO AccountNo,(CASE WHEN BANK_ACCOUNT_TYPE='10' THEN 'SB' ELSE 'CA' END)	AccountType,
ISNULL(BA.BANKNAME,C.BANK_NAME) BANKNAME,BANK_ADD1 BankBranch,''BankBranchCode,BK_CITY BankCity,C.TYPE AS PersonalStatus,
TaxStatus =(CASE WHEN CL_STATUS IN ('IND','ROR') THEN '01'  
                 WHEN CL_STATUS IN ('HUF') THEN '03' 
				 WHEN CL_STATUS IN ('PF') THEN '06' 
				 WHEN CL_STATUS IN ('BCP') THEN '07'  
				 WHEN CL_STATUS IN ('TS') THEN '08'
				 WHEN CL_STATUS IN ('COM','DFI','NOR','OTH','QFI','SB') THEN '10'
				 WHEN CL_STATUS IN ('BA','BNK') THEN '14'
				 WHEN CL_STATUS IN ('NRE','NRI','NRO') THEN '21'
				 WHEN CL_STATUS IN ('MF','MFF') THEN '36'
				 ELSE '10' END)
,Category,'CDSL'DepositoryName,
'ANGEL BROKING PVT LTD' DPName ,'12032000'	DPID,CLIENT_CODE BeneficiaryAccountNo,SECOND_HOLD_NAME SecondAppName,THIRD_HOLD_NAME ThirdAppName,BO_DOB DOB1,
'' DOB2,''	DOB3,FIRST_HOLD_PAN PANNo1,SECOND_HOLD_ITPAN PANNo2,THIRD_HOLD_ITPAN PANNo3,
''MINNo1,''	MINNo2,''	MINNo3,'NA'EcsNo,'NA' UINNo,FIRST_HOLD_FNAME Father_HusbandName,
LTRIM(RTRIM(ISNULL(DPHD_GAU_FNAME,'')))+' '+LTRIM(RTRIM(ISNULL(DPHD_GAU_MNAME,'')))+' ' +LTRIM(RTRIM(ISNULL(DPHD_GAU_LNAME,''))) GuardianName,
'' GuardianRelationship, DPHD_GAU_DOB	GuardianDOB,DPHD_GAU_PAN_NO	GaurdianPANNo,''	GaurdianMINNo,
LTRIM(RTRIM(ISNULL(DPHD_NOM_FNAME,'')))+' '+LTRIM(RTRIM(ISNULL(DPHD_NOM_MNAME,'')))+' ' +LTRIM(RTRIM(ISNULL(DPHD_NOM_LNAME,''))) NomineeName,
''	NomineeRelation,''	NomineeDOB,(CASE WHEN ISNULL(POA_VER,'') IN (2,1) THEN 'Y' ELSE 'N' END)POA,''SubBroker,''	CreatedBy,ACTIVE_DATE CreatedOn,''	LastModifiedBy,''	LastModifiedOn,
BRANCH_CODE	BranchID,'NA'OtherBankName,'NA'	BankCode,BO_BRANCH_NO	IFSCCODE,'Y'	KYCflag
FROM TBL_CLIENT_MASTER 	 C
LEFT OUTER JOIN 
DP_HOLDER_DTLS ON CLIENT_CODE =DPHD_DPAM_SBA_NO 
LEFT OUTER JOIN 
BANK_MASTER T ON T.BK_BRANCH= C.BO_BRANCH_NO   AND T.BK_MICR =C.BANK_MICR
LEFT OUTER JOIN 
TYPE_MASTER I ON I.CODE= INCOME_CODE AND I.TYPE ='INCOME'
LEFT OUTER JOIN
AngelNseCM.MSAJAG.DBO.CLIENT_DETAILS CD ON CD.CL_CODE=NISE_PARTY_CODE 
LEFT OUTER JOIN 
(SELECT * FROM ( 
SELECT *,ROW_NUMBER()OVER (PARTITION BY PARTY_CODE,ACNUM ORDER BY PARTY_CODE ASC) AS rn FROM(
(
select  DISTINCT PARTY_CODE,BANKNAME,ACNUM  from AngelNseCM.MSAJAG.DBO.PARTY_BANK_DETAILS WITH(NOLOCK) WHERE PARTY_CODE IN  ('V49038','A85012','KOLK9200','K50251','NOR317','K46795','P14438',
'R47022','R6540','A23214','K17733','M53706','H10651','A99423','S158131','R68750','VL002',
'VL001','J41740','V45643')))A )A
WHERE RN=1
 ) BA ON   BA.PARTY_CODE  =NISE_PARTY_CODE AND BA.ACNUM=DIVIDEND_ACCOUNT_NO 
WHERE C.STATUS ='ACTIVE' 
and NISE_PARTY_CODE IN ('V49038','A85012','KOLK9200','K50251','NOR317','K46795','P14438',
'R47022','R6540','A23214','K17733','M53706','H10651','A99423','S158131','R68750','VL002',
'VL001','J41740','V45643')

GO
