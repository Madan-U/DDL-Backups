-- Object: FUNCTION citrus_usr.FN_CONSIDERATIONAMT_bak_13102017
-- Server: 10.253.78.167 | DB: DMAT
--------------------------------------------------

create FUNCTION [citrus_usr].[FN_CONSIDERATIONAMT_bak_13102017](@PA_ACTION VARCHAR(25),@PA_INTREF NUMERIC)
RETURNS VARCHAR(800)
AS
BEGIN
DECLARE @L_TOTAL NUMERIC(16,3),@L_RMKS VARCHAR(800),@L_COMMON VARCHAR(800)
IF @PA_ACTION='CAMT'
BEGIN
SELECT  @L_TOTAL=isnull(dptdc_line_no,'0')
--CONVERT(NUMERIC(16,3),(-1*DPTDC_QTY*( SELECT TOP 1 CLOPM_CDSL_RT FROM CLOSING_PRICE_MSTR_CDSL WHERE CLOPM_ISIN_CD = DPTDC_ISIN 
--AND CLOPM_DT <= DPTDC_EXECUTION_DT AND CLOPM_DELETED_IND = 1  ORDER BY CLOPM_DT DESC) ))
											     
FROM DP_TRX_DTLS_CDSL WHERE DPTDC_INTERNAL_REF_NO=@PA_INTREF AND DPTDC_DELETED_IND=1
SET @L_COMMON= CONVERT(VARCHAR,@L_TOTAL)
END
IF @PA_ACTION='RMKS'
BEGIN
SELECT  @L_RMKS=isnull(dptdc_line_no,'0')
--ISNULL(DPTDC_RMKS,'')											     
FROM DP_TRX_DTLS_CDSL WHERE DPTDC_INTERNAL_REF_NO=@PA_INTREF AND DPTDC_DELETED_IND=1
SET @L_COMMON= CONVERT(VARCHAR,@L_RMKS)
END
RETURN @L_COMMON
END

GO
