-- Object: PROCEDURE citrus_usr.PR_BULK_PROP_EXPORT
-- Server: 10.253.78.167 | DB: DMAT
--------------------------------------------------



Create PROCEDURE [citrus_usr].[PR_BULK_PROP_EXPORT]
(
@PA_LOGINNAMES VARCHAR(50),
@PA_BATCHNO VARCHAR(20)
)
AS
BEGIN
SELECT distinct CASE WHEN DPAM_CLICM_CD='21' THEN '02' ELSE  '03' END +'~'+DPAM_SBA_NO+'~'+ISNULL(ACF.ACCP_VALUE,'')+'~'+CASE WHEN ISNULL(ACF.ACCP_VALUE,'')='' THEN SPACE(1) ELSE '2' END  
+'~'+ISNULL(ACS.ACCP_VALUE,'')+'~'+CASE WHEN ISNULL(ACS.ACCP_VALUE,'')='' THEN '' ELSE '2' END
+'~'+ISNULL(ACT.ACCP_VALUE,'')+'~'+CASE WHEN ISNULL(ACT.ACCP_VALUE,'')='' THEN '' ELSE '2' END
+'~' VALUE,DPAM_CLICM_CD
 FROM DP_ACCT_MSTR LEFT OUTER JOIN ACCOUNT_PROPERTIES ACF ON ACF.ACCP_CLISBA_ID=DPAM_ID AND ACF.ACCP_ACCPM_PROP_CD='ADHAARFLAG' 
 LEFT OUTER JOIN  ACCOUNT_PROPERTIES ACS ON ACS.ACCP_CLISBA_ID=DPAM_ID AND ACS.ACCP_ACCPM_PROP_CD='ADHAARSECHLDR'  
 LEFT OUTER JOIN  ACCOUNT_PROPERTIES ACT ON ACT.ACCP_CLISBA_ID=DPAM_ID AND ACT.ACCP_ACCPM_PROP_CD='ADHAARTHRDHLDR' 
 ,TMP_PROP_BULK WHERE DPAM_SBA_NO=PROPBULK_BOID
AND DPAM_DELETED_IND=1
order by DPAM_CLICM_CD

END

GO
