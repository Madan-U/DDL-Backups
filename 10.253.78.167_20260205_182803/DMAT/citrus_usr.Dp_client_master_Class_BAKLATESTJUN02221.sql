-- Object: VIEW citrus_usr.Dp_client_master_Class_BAKLATESTJUN02221
-- Server: 10.253.78.167 | DB: DMAT
--------------------------------------------------




CREATE VIEW [citrus_usr].[Dp_client_master_Class_BAKLATESTJUN02221]  

AS

SELECT   DPS8_PC1.BOID BOID
--, REPLACE(REPLACE(ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'BA'),ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'BR'),'')),'_BA',''),'_BR','')   CM_BRBOFFCODE  
--, ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'RE'),'')  [REGION]
,A1.ENTM_SHORT_NAME [REGION] 
--, ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'AR'),'')  [AREA]
,B1.ENTM_SHORT_NAME [AREA] 
--, ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'BR'),'')  [BRANCH/BA CODE]  
,C1.ENTM_SHORT_NAME [BRANCH/BA CODE]  
--, ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'ONW'),ISNULL(CITRUS_USR.FN_FIND_RELATIONS(DPAM.DPAM_CRN_NO,'REM'),''))  [REMISSOR/ONWARD]
,'' [REMISSOR/ONWARD]
, ISNULL(BROM_DESC,'') DPTARIFFID  
,ISNULL(PANGIR,'') PANGIR
FROM  DPS8_PC1 WITH (NOLOCK) LEFT OUTER JOIN 
DP_ACCT_MSTR DPAM  WITH (NOLOCK) ON DPS8_PC1.BOID = DPAM_SBA_NO 
LEFT OUTER JOIN ENTITY_RELATIONSHIP A ON  A.ENTR_SBA=DPAM_SBA_NO AND A.ENTR_DELETED_IND=1 AND GETDATE() BETWEEN A.ENTR_FROM_DT 
AND ISNULL(A.ENTR_TO_DT,'DEC 31 2100')
LEFT OUTER JOIN ENTITY_MSTR A1 ON  A.ENTR_RE=A1.ENTM_ID  
LEFT OUTER JOIN ENTITY_RELATIONSHIP B ON  B.ENTR_SBA=DPAM_SBA_NO AND B.ENTR_DELETED_IND=1 AND GETDATE() BETWEEN B.ENTR_FROM_DT 
AND ISNULL(B.ENTR_TO_DT,'DEC 31 2100')
LEFT OUTER JOIN ENTITY_MSTR B1 ON  B.ENTR_AR=B1.ENTM_ID  
LEFT OUTER JOIN ENTITY_RELATIONSHIP C ON  C.ENTR_SBA=DPAM_SBA_NO AND C.ENTR_DELETED_IND=1 AND GETDATE() BETWEEN C.ENTR_FROM_DT 
AND ISNULL(C.ENTR_TO_DT,'DEC 31 2100')
LEFT OUTER JOIN ENTITY_MSTR C1 ON  C.ENTR_BR=C1.ENTM_ID  

LEFT OUTER JOIN 
CLIENT_DP_BRKG  WITH (NOLOCK)    ON DPAM_ID = CLIDB_DPAM_ID 
AND GETDATE() BETWEEN CLIDB_EFF_FROM_DT AND ISNULL(CLIDB_EFF_TO_DT  ,'DEC 31 2100') AND CLIDB_DELETED_IND = 1 
LEFT OUTER JOIN   
BROKERAGE_MSTR WITH (NOLOCK)  ON BROM_ID = CLIDB_BROM_ID    
WHERE   ISNUMERIC(DPAM.DPAM_SBA_NO)=1

GO
