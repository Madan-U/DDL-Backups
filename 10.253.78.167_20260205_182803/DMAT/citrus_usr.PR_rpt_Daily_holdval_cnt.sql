-- Object: PROCEDURE citrus_usr.PR_rpt_Daily_holdval_cnt
-- Server: 10.253.78.167 | DB: DMAT
--------------------------------------------------

--exec [citrus_usr].[PR_rpt_Daily_holdval_cnt] 'Oct 28 2020' , 'Oct 28 2020' , 'Ho'
CREATE   PROC [citrus_usr].[PR_rpt_Daily_holdval_cnt](@pa_from_dt DATETIME, @pa_to_dt DATETIME    
,@pa_login_name varchar(100)    
)          
AS          
BEGIN  
SELECT DPAM_BBO_CODE [PARTY CODE]
, DPAM_SBA_NAME [PARTY NAME], CONVERT (NUMERIC (30,2) 
, SUM(DPHMCD_FREE_QTY * RATE )  )[FREE HOLDING VALUE]
 ,  CONVERT (NUMERIC (30,2) ,SUM(DPHMCD_PLEDGE_QTY * RATE )  ) [PLEDGED VALUE]
 ,COUNT(DPHMCD_ISIN) [NO. OF ISINS]
, ''''+ DPAM_SBA_NO  [DEMAT ID]
,[POA (Y/N)] = CASE WHEN (SELECT TOP 1  HOLDERNUM  FROM DPS8_PC5 WHERE  BOID = DPAM_SBA_NO AND  TYPEOFTRANS NOT IN (3,4) 
AND MASTERPOAID = '2203320000000014' AND HOLDERNUM = '1') = 1 THEN 'YES' ELSE 'NO' END 
,STAM_DESC STATUS
 FROM DP_ACCT_MSTR
  ,HOLDINGALLFORVIEW , STATUS_MSTR
WHERE DPAM_ID = DPHMCD_DPAM_ID AND DPAM_STAM_CD = STAM_CD 
GROUP BY DPAM_BBO_CODE, DPAM_SBA_NAME, DPAM_SBA_NO, STAM_DESC, DPHMCD_DPAM_ID

end

GO
