-- Object: PROCEDURE citrus_usr.PR_INS_UPD_CHANGED_CLDTLS
-- Server: 10.253.78.167 | DB: DMAT
--------------------------------------------------

/*create table Changed_Client_Dtls
(
	CCD_ID numeric(10, 0) NOT NULL,
	CCD_CLISBA_ID VARCHAR(20) NOT NULL,
	CCD_CLI_NAME VARCHAR(100) NOT NULL,
	CCD_CLI_ADDR VARCHAR(300),
	CCD_CLI_PHNO VARCHAR(20),
    CCD_CLI_MOBILE VARCHAR(12),
    CCD_CLI_EMAIL VARCHAR(50),
	CCD_CLI_BNKACNO VARCHAR(50),
	CCD_CLI_BNKMICR VARCHAR(50),
	CCD_CLI_BNKACTYP VARCHAR(50),
	CCD_CLI_BNKNAME VARCHAR(50), 
	CCD_CLI_CHNGDATE DATETIME
)

SELECT * FROM Changed_Client_Dtls

*/




CREATE PROCEDURE [citrus_usr].[PR_INS_UPD_CHANGED_CLDTLS]
(
	 @PA_CLISBA_ID VARCHAR(20)
	,@PA_CLI_NAME VARCHAR(100)
	,@PA_CLI_ADDR VARCHAR(300)
	,@PA_CLI_PHNO VARCHAR(20)
	,@PA_CLI_MOBILE VARCHAR(12)
	,@PA_CLI_EMAIL VARCHAR(50)
	,@PA_CLI_BNKACNO VARCHAR(50)
	,@PA_CLI_BNKMICR VARCHAR(50)
	,@PA_CLI_BNKACTYP VARCHAR(50)
	,@PA_CLI_BNKNAME VARCHAR(50) 
	--,@PA_CLI_CHNGDATE DATETIME	
	,@PA_OUT varchar(8000) OUTPUT
)

AS
DECLARE @@L_CNT NUMERIC

SET @@L_CNT = ISNULL((SELECT MAX(CCD_ID) FROM Changed_Client_Dtls),0) + 1 

BEGIN
--
	BEGIN TRANSACTION	

	INSERT INTO Changed_Client_Dtls
	(CCD_ID,
	 CCD_CLISBA_ID,
	 CCD_CLI_NAME,
	 CCD_CLI_ADDR,
	 CCD_CLI_PHNO,
     CCD_CLI_MOBILE,
     CCD_CLI_EMAIL,
	 CCD_CLI_BNKACNO,
     CCD_CLI_BNKMICR,
	 CCD_CLI_BNKACTYP,
	 CCD_CLI_BNKNAME,
	 CCD_CLI_CHNGDATE)
	 VALUES
	 (	@@L_CNT,
		@PA_CLISBA_ID,
		@PA_CLI_NAME,
		@PA_CLI_ADDR,
		@PA_CLI_PHNO,
		@PA_CLI_MOBILE,
		@PA_CLI_EMAIL,
		@PA_CLI_BNKACNO,
		@PA_CLI_BNKMICR,
		@PA_CLI_BNKACTYP,
		@PA_CLI_BNKNAME,
		convert(datetime,getdate())
	 )
	
	IF @@ERROR > 1
		ROLLBACK TRANSACTION
	ELSE
		COMMIT TRANSACTION    

--
END

GO
