-- Object: PROCEDURE citrus_usr.PR_CLASS_CLIENTLOGIN_VALIDATION
-- Server: 10.253.78.167 | DB: DMAT
--------------------------------------------------

CREATE PROCEDURE [citrus_usr].[PR_CLASS_CLIENTLOGIN_VALIDATION]  
(  
@PA_LOGIN VARCHAR(20),  
@PA_KEY VARCHAR(50),  
@PA_OURGENERATEDKEY VARCHAR(50) , 
@pa_ref_cur     VARCHAR(8000) OUTPUT
)   
AS   


Begin

DECLARE @@LOGN VARCHAR(20),@@KEYUPD VARCHAR(500)  

  
--SELECT RIGHT(DPAM_SBA_NO,8)DPAM_SBA_NO,@@LOGN as CLASS_LOGIN,@@KEYUPD as VERIFICATION_KEY  FROM DP_ACCT_MSTR,ACCOUNT_PROPERTIES WHERE ACCP_ACCPM_PROP_CD='BBO_CODE' AND ACCP_VALUE=@PA_LOGIN AND DPAM_ID=ACCP_CLISBA_ID  
--AND DPAM_DELETED_IND=1 AND ACCP_DELETED_IND=1  
--UNION ALL  

--SELECT DISTINCT LOGN_NAME DPAM_SBA_NO,'' CLASSLOGIN,'' VERIFICATION_KEY
--@@LOGN as CLASS_LOGIN,@@KEYUPD as VERIFICATION_KEY
--FROM LOGIN_NAMES WHERE LOGN_NAME=@PA_LOGIN AND LOGN_DELETED_IND=1  


SELECT  DISTINCT  DPAM_SBA_NO,@PA_LOGIN CLASSLOGIN,'' VERIFICATION_KEY FROM DP_ACCT_MSTR,LOGIN_NAMES WHERE DPAM_BBO_CODE=@PA_LOGIN
AND  RIGHT(DPAM_SBA_NO,8)=LOGN_NAME  AND LOGN_DELETED_IND=1  and LOGN_STATUS = 'A'
  
END

GO
